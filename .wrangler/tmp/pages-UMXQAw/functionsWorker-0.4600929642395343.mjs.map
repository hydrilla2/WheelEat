{
  "version": 3,
  "sources": ["../bundle-Bp5THN/checked-fetch.js", "../../../functions/api/lib/d1.js", "../../../functions/api/lib/cors.js", "../../../functions/api/users.js", "../../../functions/api/lib/restaurant-places.js", "../../../functions/api/lib/restaurants.js", "../../../functions/api/categories.js", "../../../functions/api/health.js", "../../../functions/api/leaderboard.js", "../../../functions/api/malls.js", "../../../functions/api/restaurants.js", "../../../functions/api/spin.js", "functionsRoutes-0.217812760554857.mjs", "file:///C:/Users/User/AppData/Roaming/npm/node_modules/wrangler/node_modules/path-to-regexp/src/index.ts", "file:///C:/Users/User/AppData/Roaming/npm/node_modules/wrangler/templates/pages-template-worker.ts", "file:///C:/Users/User/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "file:///C:/Users/User/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-Bp5THN/middleware-insertion-facade.js", "file:///C:/Users/User/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/common.ts", "../bundle-Bp5THN/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\WheelEatNew\\WheelEat\\.wrangler\\tmp\\pages-UMXQAw\\functionsWorker-0.4600929642395343.mjs",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "// D1 database utility for Cloudflare Pages Functions\r\n// This file handles connecting to Cloudflare D1 database\r\n\r\n// Helper function to get D1 database from environment\r\nexport function getD1Database(env) {\r\n  const db = env.DB; // D1 database binding\r\n\r\n  if (!db) {\r\n    throw new Error(\r\n      'Missing D1 database binding. ' +\r\n      'Please bind the D1 database to your Pages project in Cloudflare dashboard.'\r\n    );\r\n  }\r\n\r\n  return db;\r\n}\r\n\r\n// Helper function to generate UUID (for SQLite compatibility)\r\nexport function generateUUID() {\r\n  return crypto.randomUUID();\r\n}\r\n\r\n// Helper function to get current timestamp as Unix epoch (integer)\r\nexport function getCurrentTimestamp() {\r\n  return Math.floor(Date.now() / 1000);\r\n}\r\n\r\n", "// CORS helper for Cloudflare Pages Functions\r\n// This ensures CORS headers are ALWAYS set\r\n\r\nexport function setCORSHeaders(headers) {\r\n  headers.set('Access-Control-Allow-Origin', '*');\r\n  headers.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\r\n  headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\r\n  headers.set('Access-Control-Max-Age', '86400');\r\n}\r\n\r\nexport function createCORSResponse() {\r\n  const headers = new Headers();\r\n  setCORSHeaders(headers);\r\n  return new Response(null, { status: 200, headers });\r\n}\r\n\r\nexport function jsonResponse(data, status = 200) {\r\n  const headers = new Headers();\r\n  setCORSHeaders(headers);\r\n  headers.set('Content-Type', 'application/json');\r\n  return new Response(JSON.stringify(data), { status, headers });\r\n}\r\n\r\n", "// GET /api/users - Get all users\r\n// POST /api/users - Create or update a user (for Google login)\r\n\r\nimport { getD1Database, generateUUID, getCurrentTimestamp } from './lib/d1.js';\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\n\r\n// GET /api/users - Get all users\r\nexport async function onRequestGet(context) {\r\n  const { request, env } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  try {\r\n    // Query D1 for users\r\n    const db = getD1Database(env);\r\n    const result = await db.prepare(\r\n      'SELECT * FROM users LIMIT 10'\r\n    ).all();\r\n\r\n    if (!result.success) {\r\n      console.error('Database error:', result.error);\r\n      return jsonResponse({\r\n        error: 'Database error',\r\n        message: result.error?.message || 'Unknown error',\r\n        hint: 'Make sure the \"users\" table exists in D1',\r\n      }, 500);\r\n    }\r\n\r\n    return jsonResponse({\r\n      success: true,\r\n      count: result.results ? result.results.length : 0,\r\n      users: result.results || [],\r\n    });\r\n  } catch (error) {\r\n    console.error('API error:', error);\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n// POST /api/users - Create or update a user (upsert)\r\nexport async function onRequestPost(context) {\r\n  const { request, env } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  try {\r\n    // Parse request body\r\n    let body;\r\n    try {\r\n      body = await request.json();\r\n    } catch (e) {\r\n      return jsonResponse({ error: 'Invalid JSON in request body' }, 400);\r\n    }\r\n\r\n    // Validate required fields\r\n    if (!body.id || !body.email) {\r\n      return jsonResponse({\r\n        error: 'Missing required fields',\r\n        message: 'Both \"id\" and \"email\" are required',\r\n      }, 400);\r\n    }\r\n\r\n    const db = getD1Database(env);\r\n    const timestamp = getCurrentTimestamp();\r\n\r\n    // Check if user already exists\r\n    const existingUser = await db.prepare(\r\n      'SELECT * FROM users WHERE id = ? OR email = ?'\r\n    ).bind(body.id, body.email).first();\r\n\r\n    if (existingUser) {\r\n      // Update existing user\r\n      const result = await db.prepare(\r\n        `UPDATE users \r\n         SET name = ?, email = ?, updated_at = ?\r\n         WHERE id = ? OR email = ?`\r\n      ).bind(\r\n        body.name || existingUser.name,\r\n        body.email,\r\n        timestamp,\r\n        body.id,\r\n        body.email\r\n      ).run();\r\n\r\n      if (!result.success) {\r\n        console.error('Database update error:', result.error);\r\n        return jsonResponse({\r\n          error: 'Database error',\r\n          message: result.error?.message || 'Failed to update user',\r\n        }, 500);\r\n      }\r\n\r\n      // Fetch updated user\r\n      const updatedUser = await db.prepare(\r\n        'SELECT * FROM users WHERE id = ? OR email = ?'\r\n      ).bind(body.id, body.email).first();\r\n\r\n      return jsonResponse({\r\n        success: true,\r\n        action: 'updated',\r\n        user: updatedUser,\r\n      });\r\n    } else {\r\n      // Insert new user\r\n      const result = await db.prepare(\r\n        `INSERT INTO users (id, name, email, created_at, updated_at)\r\n         VALUES (?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        body.id,\r\n        body.name || 'User',\r\n        body.email,\r\n        timestamp,\r\n        timestamp\r\n      ).run();\r\n\r\n      if (!result.success) {\r\n        console.error('Database insert error:', result.error);\r\n        return jsonResponse({\r\n          error: 'Database error',\r\n          message: result.error?.message || 'Failed to create user',\r\n        }, 500);\r\n      }\r\n\r\n      // Fetch created user\r\n      const newUser = await db.prepare(\r\n        'SELECT * FROM users WHERE id = ?'\r\n      ).bind(body.id).first();\r\n\r\n      return jsonResponse({\r\n        success: true,\r\n        action: 'created',\r\n        user: newUser,\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('API error:', error);\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n// Main handler - routes GET and POST requests\r\nexport async function onRequest(context) {\r\n  const { request } = context;\r\n\r\n  if (request.method === 'GET') {\r\n    return onRequestGet(context);\r\n  } else if (request.method === 'POST') {\r\n    return onRequestPost(context);\r\n  } else if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  } else {\r\n    return jsonResponse({ error: 'Method not allowed' }, 405);\r\n  }\r\n}\r\n", "// Restaurant to Google Maps short link ID mapping\r\n// These are the short link IDs from https://maps.app.goo.gl/{id}\r\n// Format: { mallId: { restaurantName: linkId } }\r\n\r\nexport const RESTAURANT_PLACE_IDS = {\r\n  sunway_square: {\r\n    \"103 Coffee\": \"fbBLzNbbAhyC5EtD8\",\r\n    \"A'Decade\": \"9cyHNx553ExuJ3hi6\",\r\n    \"Armoury Steakhouse\": \"8cy6us9hjZZAfgQU7\",\r\n    \"BESTORE\": \"bZcgGiT72iYHjSF37\",\r\n    \"Black Canyon\": \"bDrUgbEaBWs6N9z76\",\r\n    \"Ba Shu Jia Yan\": \"rAbFM3inKp4fiXjT6\",\r\n    \"Beutea\": \"gTpa8hVRC3zoFKvX8\",\r\n    \"Bread History\": \"YNf3xqP7gjnenGRz7\",\r\n    \"Chagee\": \"hsHB84aUzaJMoYwV6\",\r\n    \"Coffee Bean\": \"8UQKcnuq4poo2TtP7\",\r\n    \"Christine's Bakery Cafe\": \"Vzi3pQPYAb4VPVWB7\",\r\n    \"CHUCHAT\": \"HdHo9caEHwqE7FR46\",\r\n    \"ChaPanda\": null,\r\n    \"CU Mart\": \"81pYamF1w1PyF43R6\",\r\n    \"Come Buy Yakiniku\": \"ieY95nnWVsQeYHQJ7\",\r\n    \"Count (Flower Drum)\": \"iPbZbNnu8CbcaND67\",\r\n    \"Chatramue\": \"Bw8NZrf3AmpLFkhK7\",\r\n    \"DOZO\": \"fqCY31DUaC8ChX3o6\",\r\n    \"Empire Sushi\": null,\r\n    \"Far Coffee\": \"a7GEwwkEoMzeLmkZ9\",\r\n    \"Fong Woh Tong\": null,\r\n    \"Gong Luck Cafe\": \"Bceop6WU4we1Vu5S9\",\r\n    \"Gokoku Japanese Bakery\": \"HwodhKyk5ZQ5m6LR9\",\r\n    \"Gong Cha\": null,\r\n    \"Hock Kee Kopitiam\": \"2yJdQL9CPr1oDr3z5\",\r\n    \"Han Bun Sik\": \"xUT7WYerdouKGsoa7\",\r\n    \"Happy Potato\": \"FVPDE4T5dpLSE7Mt5\",\r\n    \"I'm Bagel\": \"aK4sMT9zBwCm1XeU7\",\r\n    \"I LIKE & Yogurt In A Can\": \"LRsojAytvsBgzqpv9\",\r\n    \"JP & CO\": \"56FcqA8teoZ5Ku4u6\",\r\n    \"Kanteen\": null,\r\n    \"Kenangan Coffee\": \"M2fq3Pfzwnyre2ni7\",\r\n    \"Kedai Kopi Malaya\": \"C8hWQKMMUnd618Uc6\",\r\n    \"Kha Coffee Roaster\": \"ngRqG79LMDokFfqr9\",\r\n    \"LLAO LLAO\": \"AY2o8QkqQuucspDJ9\",\r\n    \"Luckin\": \"hsrTZRaaK5UbvEHeA\",\r\n    \"Manjoe\": \"3v2opuM9JvVk8RRS9\",\r\n    \"Mix.Store\": \"GiJVi2Uqk4TibUpc7\",\r\n    \"Mr. Wu\": \"3SrpfuxhL2SYk7aXA\",\r\n    \"Missy Sushi\": \"sPSthzG1BSRjos1N6\",\r\n    \"Nasi Lemak Shop\": \"jZBwji1p2b85ovuKA\",\r\n    \"Nine Dragon Char Chan Teng (Kowloon Cafe)\": \"HCDjtpfo6AaBHprU8\",\r\n    \"Nippon Sushi\": \"x9YSdRGxkuHrxiQm6\",\r\n    \"Odon Beyond\": \"L53kDg7b1HyfrdKH6\",\r\n    \"One Dish One Taste\": null,\r\n    \"Pak Curry\": \"wn7z5CQfESoZG4iD9\",\r\n    \"Ramen Mob\": \"zrcMQS1tvyWiEpya6\",\r\n    \"Richeese Factory\": \"RNK7dyqkSNLNP2V8A\",\r\n    \"Sweetie\": null,\r\n    \"Salad Atelier\": \"tgAYaAv18MnbCtHr5\",\r\n    \"Super Matcha\": \"6QjRZ6edKZofvyN27\",\r\n    \"Shabuyaki by Nippon Sushi\": null,\r\n    \"Stuff'D\": \"5yw6fwJcvoGT8GHc6\",\r\n    \"Subway\": null,\r\n    \"The Public House\": \"D3e43oMf2zMd7ASu5\",\r\n    \"Tealive Plus\": null,\r\n    \"Tang Gui Fei Tanghulu\": \"21VFJna44i6xYref9\",\r\n    \"The Walking Hotpot Signature\": \"gPrcGRUEhAgAzCSJ7\",\r\n    \"The Chicken Rice Shop\": \"mbxDFcZV8jzmBWaM6\",\r\n    \"Village Grocer\": \"H3spKPGzaj6war8A9\",\r\n    \"Yellow Bento\": \"XuXetfXJVGaxJNBG8\",\r\n    \"Yonny\": \"UdP75iyUAGZJ6HgX8\",\r\n    \"Yama by Hojichaya\": \"GNJeSQDHNkWJNa4KA\",\r\n    \"Yogurt Planet\": \"wCyZNRzR3HJZka2y6\",\r\n    \"Zus Coffee\": \"ciunsPEq5nqnp54g7\",\r\n    \"Zok Noodle House\": \"gdejSbdHpXJHJe5X9\",\r\n  },\r\n};\r\n\r\nexport function getPlaceId(restaurantName, mallId = \"sunway_square\") {\r\n  return RESTAURANT_PLACE_IDS[mallId]?.[restaurantName] || null;\r\n}\r\n\r\n", "// Restaurant data for multiple malls\r\n// Format: [Restaurant Name, Unit Number, Floor, Category, Halal Status]\r\n\r\nimport { getPlaceId } from './restaurant-places.js';\r\n\r\nexport const MALL_RESTAURANTS = {\r\n  sunway_square: [\r\n    [\"103 Coffee\", \"L1-07\", \"LG\", \"Coffee & Cafes\", false],\r\n    [\"A'Decade\", \"L2-22\", \"L2\", \"Local & Malaysian\", true],\r\n    [\"Armoury Steakhouse\", \"LG-05\", \"LG\", \"Western & International\", false],\r\n    [\"BESTORE\", \"L1-39\", \"L1\", \"Snacks & Specialty Store\", false],\r\n    [\"Black Canyon\", \"L1-40\", \"L1\", \"Western & International\", true],\r\n    [\"Ba Shu Jia Yan\", \"LG-09 & LG-10\", \"LG\", \"Chinese & Taiwanese\", false],\r\n    [\"Beutea\", \"LG1-02\", \"LG1\", \"Tea & Beverages\", true],\r\n    [\"Bread History\", \"LG1-25\", \"LG1\", \"Bakery & Pastry\", true],\r\n    [\"Chagee\", \"L1-04\", \"L1\", \"Tea & Beverages\", true],\r\n    [\"Coffee Bean\", \"L1-31\", \"L1\", \"Coffee & Cafes\", true],\r\n    [\"Christine's Bakery Cafe\", \"L1-42\", \"L1\", \"Bakery & Pastry\", true],\r\n    [\"CHUCHAT\", \"L1-06\", \"L1\", \"Tea & Beverages\", true],\r\n    [\"ChaPanda\", \"L2-01\", \"L2\", \"Tea & Beverages\", true],\r\n    [\"CU Mart\", \"L2-28\", \"L2\", \"Korean & Convenience\", false],\r\n    [\"Come Buy Yakiniku\", \"LG-01\", \"LG\", \"Japanese Cuisine\", false],\r\n    [\"Count (Flower Drum)\", \"LG-06 & LG-07\", \"LG\", \"Chinese & Taiwanese\", false],\r\n    [\"Chatramue\", \"LG1-18\", \"LG1\", \"Tea & Beverages\", true],\r\n    [\"DOZO\", \"L1-41\", \"L1\", \"Japanese Cuisine\", false],\r\n    [\"Empire Sushi\", \"LG1-22\", \"LG1\", \"Japanese Cuisine\", true],\r\n    [\"Far Coffee\", \"L2-18A\", \"L2\", \"Coffee & Cafes\", true],\r\n    [\"Fong Woh Tong\", \"LG1-23\", \"LG1\", \"Chinese & Taiwanese\", true],\r\n    [\"Gong Luck Cafe\", \"L1-30\", \"L1\", \"Local & Malaysian\", false],\r\n    [\"Gokoku Japanese Bakery\", \"L1-44\", \"L1\", \"Bakery & Pastry\", true],\r\n    [\"Gong Cha\", \"L2-02\", \"L2\", \"Tea & Beverages\", true],\r\n    [\"Hock Kee Kopitiam\", \"L1-43\", \"L1\", \"Local & Malaysian\", true],\r\n    [\"Han Bun Sik\", \"L2-12\", \"L2\", \"Korean Cuisine\", false],\r\n    [\"Happy Potato\", \"L2-04\", \"L2\", \"Snacks & Desserts\", true],\r\n    [\"I'm Bagel\", \"L2-29\", \"L2\", \"Western & International\", true],\r\n    [\"I LIKE & Yogurt In A Can\", \"L2-03\", \"L2\", \"Snacks & Desserts\", true],\r\n    [\"JP & CO\", \"L1-45\", \"L1\", \"Western & International\", true],\r\n    [\"Kanteen\", \"L1-08\", \"L1\", \"Local & Malaysian\", true],\r\n    [\"Kenangan Coffee\", \"L2-08\", \"L2\", \"Coffee & Cafes\", true],\r\n    [\"Kedai Kopi Malaya\", \"LG1-20\", \"LG1\", \"Local & Malaysian\", true],\r\n    [\"Kha Coffee Roaster\", \"LG1-14\", \"LG1\", \"Coffee & Cafes\", true],\r\n    [\"LLAO LLAO\", \"L1-14\", \"L1\", \"Snacks & Desserts\", true],\r\n    [\"Luckin\", \"L1-05\", \"L1\", \"Coffee & Cafes\", true],\r\n    [\"Manjoe\", \"L1-17\", \"L1\", \"Chinese & Taiwanese\", false],\r\n    [\"Mix.Store\", \"LG-04\", \"LG\", \"Snacks & Specialty Store\", false],\r\n    [\"Mr. Wu\", \"LG-11\", \"LG\", \"Chinese & Taiwanese\", false],\r\n    [\"Missy Sushi\", \"LG-06\", \"LG\", \"Japanese Cuisine\", false],\r\n    [\"Nasi Lemak Shop\", \"LG1-16\", \"LG1\", \"Local & Malaysian\", true],\r\n    [\"Nine Dragon Char Chan Teng (Kowloon Cafe)\", \"LG1-13\", \"LG1\", \"Chinese & Taiwanese\", false],\r\n    [\"Nippon Sushi\", \"LG1-01\", \"LG1\", \"Japanese Cuisine\", true],\r\n    [\"Odon Beyond\", \"L1-03\", \"L1\", \"Japanese Cuisine\", false],\r\n    [\"One Dish One Taste\", \"LG1-12B\", \"LG1\", \"Chinese & Taiwanese\", false],\r\n    [\"Pak Curry\", \"LG1-26\", \"LG1\", \"Local & Malaysian\", true],\r\n    [\"Ramen Mob\", \"L1-12\", \"L1\", \"Japanese Cuisine\", false],\r\n    [\"Richeese Factory\", \"LG1-15\", \"LG1\", \"Fast Food\", true],\r\n    [\"Sweetie\", \"LG1-24\", \"LG1\", \"Snacks & Desserts\", true],\r\n    [\"Salad Atelier\", \"L1-01\", \"L1\", \"Western & International\", true],\r\n    [\"Super Matcha\", \"L1-20\", \"L1\", \"Tea & Beverages\", true],\r\n    [\"Shabuyaki by Nippon Sushi\", \"LG-12 & LG-13\", \"LG\", \"Japanese Cuisine\", true],\r\n    [\"Stuff'D\", \"LG1-27\", \"LG1\", \"Western & International\", true],\r\n    [\"Subway\", \"LG1-21\", \"LG1\", \"Fast Food\", true],\r\n    [\"The Public House\", \"L1-09\", \"L1\", \"Western & International\", false],\r\n    [\"Tealive Plus\", \"L2-30\", \"L2\", \"Tea & Beverages\", true],\r\n    [\"Tang Gui Fei Tanghulu\", \"L2-17\", \"L2\", \"Snacks & Desserts\", true],\r\n    [\"The Walking Hotpot Signature\", \"L2-23\", \"L2\", \"Chinese & Taiwanese\", false],\r\n    [\"The Chicken Rice Shop\", \"LG1-10\", \"LG1\", \"Local & Malaysian\", true],\r\n    [\"Village Grocer\", \"LG1-05 to LG1-09\", \"LG1\", \"Supermarket\", false],\r\n    [\"Yellow Bento\", \"L2-01\", \"L2\", \"Japanese Cuisine\", false],\r\n    [\"Yonny\", \"L1-32\", \"L1\", \"Chinese & Taiwanese\", false],\r\n    [\"Yama by Hojichaya\", \"L2-10A\", \"L2\", \"Japanese Cuisine\", true],\r\n    [\"Yogurt Planet\", \"LG1-19\", \"LG1\", \"Snacks & Desserts\", true],\r\n    [\"Zus Coffee\", \"L1-02\", \"L1\", \"Coffee & Cafes\", true],\r\n    [\"Zok Noodle House\", \"L2-24\", \"L2\", \"Chinese & Taiwanese\", false],\r\n  ],\r\n};\r\n\r\n// Mall metadata\r\nexport const MALL_INFO = {\r\n  sunway_square: {\r\n    name: \"Sunway Square\",\r\n    display_name: \"Sunway Square Mall\"\r\n  },\r\n};\r\n\r\n// Logo mapping\r\nconst LOGO_MAPPING = {\r\n  \"103 Coffee\": \"103-coffee.png\",\r\n  \"A'Decade\": \"a'decade.png\",\r\n  \"Armoury Steakhouse\": \"armoury-steakhouse.png\",\r\n  \"BESTORE\": \"bestore.png\",\r\n  \"Black Canyon\": \"black-canyon.png\",\r\n  \"Ba Shu Jia Yan\": \"ba-shu-jia-yan.png\",\r\n  \"Beutea\": \"beutea.png\",\r\n  \"Bread History\": \"bread-history.png\",\r\n  \"Chagee\": \"chagee.png\",\r\n  \"Coffee Bean\": \"coffee-bean.png\",\r\n  \"Christine's Bakery Cafe\": \"christine's-bakery-cafe.png\",\r\n  \"CHUCHAT\": \"chuchat.png\",\r\n  \"ChaPanda\": \"chapanda.png\",\r\n  \"CU Mart\": \"cumart.png\",\r\n  \"Come Buy Yakiniku\": \"come-buy-yakiniku.png\",\r\n  \"Count (Flower Drum)\": \"count(flower-drum).png\",\r\n  \"Chatramue\": \"chatramue.png\",\r\n  \"DOZO\": \"dozo.png\",\r\n  \"Empire Sushi\": \"empire-sushi.png\",\r\n  \"Far Coffee\": \"far-coffee.png\",\r\n  \"Fong Woh Tong\": \"fong-woh-tong.png\",\r\n  \"Gong Luck Cafe\": \"gong-luck-cafe.png\",\r\n  \"Gokoku Japanese Bakery\": \"gokoku-japanese-bakery.png\",\r\n  \"Gong Cha\": \"gong-cha.png\",\r\n  \"Hock Kee Kopitiam\": \"hock-kee-kopitiam.png\",\r\n  \"Han Bun Sik\": \"han-bun-sik.png\",\r\n  \"Happy Potato\": \"happy-potato.png\",\r\n  \"I'm Bagel\": \"i'm-bagel.png\",\r\n  \"I LIKE & Yogurt In A Can\": \"i-like-&-yogurt-in-a-can.png\",\r\n  \"JP & CO\": \"jp-&-co.png\",\r\n  \"Kanteen\": \"kanteen.png\",\r\n  \"Kenangan Coffee\": \"kenangan-coffee.png\",\r\n  \"Kedai Kopi Malaya\": \"kedai-kopi-malaya.png\",\r\n  \"Kha Coffee Roaster\": \"kha-coffee-roaster.png\",\r\n  \"LLAO LLAO\": \"llao-llao.png\",\r\n  \"Luckin\": \"luckin.png\",\r\n  \"Manjoe\": \"manjoe.png\",\r\n  \"Mix.Store\": \"mix.store.png\",\r\n  \"Mr. Wu\": \"mr.wu.png\",\r\n  \"Missy Sushi\": \"missy-sushi.jpeg\",\r\n  \"Nasi Lemak Shop\": \"nasi-lemak-shop.png\",\r\n  \"Nine Dragon Char Chan Teng (Kowloon Cafe)\": \"nine-dragon-char-chan-teng-(kowloon-cafe).png\",\r\n  \"Nippon Sushi\": \"nippon-sushi.png\",\r\n  \"Odon Beyond\": \"odon-beyond.png\",\r\n  \"One Dish One Taste\": \"one-dish-one-taste.png\",\r\n  \"Pak Curry\": \"pak-curry.png\",\r\n  \"Ramen Mob\": \"ramen-mob.png\",\r\n  \"Richeese Factory\": \"richeese-factory.png\",\r\n  \"Sweetie\": \"sweetie.jpg\",\r\n  \"Salad Atelier\": \"salad-atelier.png\",\r\n  \"Super Matcha\": \"super-matcha.png\",\r\n  \"Shabuyaki by Nippon Sushi\": \"shabuyaki-by-nippon-sushi.png\",\r\n  \"Stuff'D\": \"stuff'd.png\",\r\n  \"Subway\": \"subway.png\",\r\n  \"The Public House\": \"the-public-house.png\",\r\n  \"Tealive Plus\": \"tealive-plus.png\",\r\n  \"Tang Gui Fei Tanghulu\": \"tang-gui-fei-tanghulu.png\",\r\n  \"The Walking Hotpot Signature\": \"the-walking-hotpot-signature.png\",\r\n  \"The Chicken Rice Shop\": \"the-chicken-rice-shop.png\",\r\n  \"Village Grocer\": \"village-grocer.png\",\r\n  \"Yellow Bento\": \"yellow-bento.jpeg\",\r\n  \"Yonny\": \"yonny.png\",\r\n  \"Yama by Hojichaya\": \"yama-by-hojichaya.png\",\r\n  \"Yogurt Planet\": \"yogurt-planet.png\",\r\n  \"Zus Coffee\": \"zus-coffee.png\",\r\n  \"Zok Noodle House\": \"zok-noodle-house.png\",\r\n};\r\n\r\nexport function getLogoPath(restaurantName, mallId = \"sunway_square\") {\r\n  const logoFilename = LOGO_MAPPING[restaurantName];\r\n  if (logoFilename) {\r\n    return `images/logo/${logoFilename}`;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function getGoogleMapsLink(restaurantName, mallId = \"sunway_square\") {\r\n  const placeId = getPlaceId(restaurantName, mallId);\r\n  \r\n  if (placeId) {\r\n    return `https://maps.app.goo.gl/${placeId}`;\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\nexport function getAvailableMalls() {\r\n  return Object.keys(MALL_RESTAURANTS);\r\n}\r\n\r\nexport function getMallInfo(mallId) {\r\n  return MALL_INFO[mallId] || { name: mallId, display_name: mallId };\r\n}\r\n\r\nexport function getRestaurantsByMall(mallId) {\r\n  return MALL_RESTAURANTS[mallId] || [];\r\n}\r\n\r\nexport function getRestaurantsByCategories(categories, mallId = \"sunway_square\", dietaryNeed = \"any\") {\r\n  const restaurants = getRestaurantsByMall(mallId);\r\n  const matchingRestaurants = [];\r\n  \r\n  for (const restaurant of restaurants) {\r\n    const [name, unit, floor, category, isHalal] = restaurant;\r\n    \r\n    // Check if category matches\r\n    if (!categories.includes(category)) {\r\n      continue;\r\n    }\r\n    \r\n    // Check if dietary need matches\r\n    if (dietaryNeed === \"halal_pork_free\" && !isHalal) {\r\n      continue;\r\n    }\r\n    \r\n    const logoPath = getLogoPath(name, mallId);\r\n    matchingRestaurants.push({\r\n      name,\r\n      unit,\r\n      floor,\r\n      category,\r\n      isHalal,\r\n      logo: logoPath\r\n    });\r\n  }\r\n  \r\n  return matchingRestaurants;\r\n}\r\n\r\nexport function getAllCategories(mallId = \"sunway_square\") {\r\n  const restaurants = getRestaurantsByMall(mallId);\r\n  const categories = new Set();\r\n  \r\n  for (const restaurant of restaurants) {\r\n    categories.add(restaurant[3]); // Category is at index 3\r\n  }\r\n  \r\n  return Array.from(categories).sort();\r\n}\r\n\r\n", "// GET /api/categories?mall_id=<mall_id>\r\n// Get all available restaurant categories for a specific mall\r\n\r\nimport { getAllCategories } from './lib/restaurants.js';\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\n\r\nexport async function onRequest(context) {\r\n  const { request } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  // Only allow GET requests\r\n  if (request.method !== 'GET') {\r\n    return jsonResponse({ error: 'Method not allowed' }, 405);\r\n  }\r\n\r\n  try {\r\n    const url = new URL(request.url);\r\n    const mallId = url.searchParams.get('mall_id') || 'sunway_square';\r\n    const categories = getAllCategories(mallId);\r\n\r\n    return jsonResponse({ categories });\r\n  } catch (error) {\r\n    console.error('Error fetching categories:', error);\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n", "// GET /api/health\r\n// Simple health check endpoint to verify the API is working\r\n\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\n\r\nexport async function onRequest(context) {\r\n  const { request } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  // Only allow GET requests\r\n  if (request.method !== 'GET') {\r\n    return jsonResponse({ error: 'Method not allowed' }, 405);\r\n  }\r\n\r\n  try {\r\n    return jsonResponse({\r\n      status: 'ok',\r\n      message: 'WheelEat API is running',\r\n      timestamp: new Date().toISOString(),\r\n    });\r\n  } catch (error) {\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n", "// GET /api/leaderboard?mall_id=<mall_id>\r\n// Returns a leaderboard-ready list of restaurants for a mall, enriched with Google Places rating + review count.\r\n//\r\n// Notes:\r\n// - Uses your static restaurant list (category/unit/floor/logo) as the source of truth.\r\n// - Enriches with Google Places \"Text Search\" results for \"restaurants in <mall>\".\r\n// - Caches results for a short time to reduce repeated API calls.\r\n\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\nimport { getMallInfo, getRestaurantsByMall, getLogoPath } from './lib/restaurants.js';\r\nimport { getPlaceId } from './lib/restaurant-places.js';\r\n\r\nconst CACHE_TTL_SECONDS = 300; // 5 minutes\r\n\r\nfunction toRestaurantObject(row, mallId) {\r\n  // Source of truth is restaurants.js: [Restaurant Name, Unit Number, Floor, Category, Halal Status]\r\n  if (!Array.isArray(row)) return null;\r\n  const [name, unit, floor, category] = row;\r\n  if (!name) return null;\r\n  return {\r\n    name,\r\n    unit: unit || null,\r\n    floor: floor || null,\r\n    category: category || 'Unknown',\r\n    logo: getLogoPath(name, mallId),\r\n  };\r\n}\r\n\r\nfunction normalizeName(input) {\r\n  return String(input || '')\r\n    .toLowerCase()\r\n    .replace(/&/g, 'and')\r\n    .replace(/[^a-z0-9]+/g, ' ')\r\n    .trim();\r\n}\r\n\r\nfunction tokenize(s) {\r\n  const norm = normalizeName(s);\r\n  return norm ? norm.split(' ').filter(Boolean) : [];\r\n}\r\n\r\nfunction matchScore(aName, bName) {\r\n  // Simple token overlap score; good enough for mall-restaurant names.\r\n  const a = tokenize(aName);\r\n  const b = tokenize(bName);\r\n  if (a.length === 0 || b.length === 0) return 0;\r\n  const setA = new Set(a);\r\n  const setB = new Set(b);\r\n  let inter = 0;\r\n  for (const t of setA) if (setB.has(t)) inter += 1;\r\n  const union = new Set([...setA, ...setB]).size || 1;\r\n  const jaccard = inter / union;\r\n  // Bonus for exact normalized equality\r\n  const exact = normalizeName(aName) === normalizeName(bName) ? 1 : 0;\r\n  return jaccard + exact;\r\n}\r\n\r\nfunction pickBestMatch(targetName, places) {\r\n  const target = normalizeName(targetName);\r\n  if (!target) return null;\r\n\r\n  let best = null;\r\n  let bestScore = -1;\r\n  for (const p of places) {\r\n    const pn = p?.name;\r\n    if (!pn) continue;\r\n    const score = matchScore(targetName, pn);\r\n    if (score > bestScore) {\r\n      bestScore = score;\r\n      best = p;\r\n    }\r\n  }\r\n  // Require some minimal similarity so we don\u2019t attach random places.\r\n  return bestScore >= 0.4 ? best : null;\r\n}\r\n\r\n/**\r\n * Fetch place details by place_id using Place Details API\r\n * @param {string} placeId - Google Places place_id\r\n * @param {string} apiKey - Google Places API key\r\n * @returns {Promise<object|null>} - Place details or null\r\n */\r\nasync function fetchPlaceDetails(placeId, apiKey) {\r\n  if (!placeId || !apiKey) return null;\r\n  \r\n  try {\r\n    // Try new Places API first\r\n    const baseUrl = `https://places.googleapis.com/v1/places/${placeId}`;\r\n    \r\n    const res = await fetch(baseUrl, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Goog-Api-Key': apiKey,\r\n        'X-Goog-FieldMask': 'id,displayName,rating,userRatingCount',\r\n      },\r\n    });\r\n\r\n    if (res.ok) {\r\n      const data = await res.json();\r\n      return {\r\n        name: data.displayName?.text || data.displayName,\r\n        rating: data.rating,\r\n        user_ratings_total: data.userRatingCount,\r\n        place_id: data.id || placeId,\r\n      };\r\n    }\r\n    \r\n    // Fallback to legacy Place Details API\r\n    return await fetchPlaceDetailsLegacy(placeId, apiKey);\r\n  } catch (error) {\r\n    console.log(`New Places API error for place_id ${placeId}, trying legacy: ${error.message}`);\r\n    return await fetchPlaceDetailsLegacy(placeId, apiKey);\r\n  }\r\n}\r\n\r\n/**\r\n * Fetch place details using legacy Place Details API\r\n * @param {string} placeId - Google Places place_id\r\n * @param {string} apiKey - Google Places API key\r\n * @returns {Promise<object|null>} - Place details or null\r\n */\r\nasync function fetchPlaceDetailsLegacy(placeId, apiKey) {\r\n  if (!placeId || !apiKey) return null;\r\n  \r\n  try {\r\n    const baseUrl = 'https://maps.googleapis.com/maps/api/place/details/json';\r\n    const url = new URL(baseUrl);\r\n    url.searchParams.set('place_id', placeId);\r\n    url.searchParams.set('key', apiKey);\r\n    url.searchParams.set('fields', 'name,rating,user_ratings_total,place_id');\r\n\r\n    console.log(`Fetching Place Details for ${placeId}...`);\r\n    let res;\r\n    try {\r\n      res = await fetch(url.toString());\r\n    } catch (error) {\r\n      // Catch \"Too many subrequests\" error from Cloudflare\r\n      if (error.message && error.message.includes('Too many subrequests')) {\r\n        console.error(`\u26A0\uFE0F Cloudflare subrequest limit reached for ${placeId}. This is a Cloudflare Pages limit, not an API issue.`);\r\n        throw error; // Re-throw to be handled by caller\r\n      }\r\n      throw error;\r\n    }\r\n    \r\n    if (!res.ok) {\r\n      const text = await res.text().catch(() => '');\r\n      throw new Error(`Place Details API failed: HTTP ${res.status} - ${text}`);\r\n    }\r\n\r\n    const data = await res.json();\r\n    \r\n    if (data.status === 'OK' && data.result) {\r\n      return {\r\n        name: data.result.name,\r\n        rating: data.result.rating,\r\n        user_ratings_total: data.result.user_ratings_total,\r\n        place_id: data.result.place_id || placeId,\r\n      };\r\n      \r\n      // Log success with details\r\n      if (result.rating !== null && result.rating !== undefined) {\r\n        console.log(`\u2705 Place Details API success for ${placeId}: rating=${result.rating}, reviews=${result.user_ratings_total}`);\r\n      } else {\r\n        console.log(`\u26A0\uFE0F Place Details API found ${placeId} but no rating available (name: ${result.name})`);\r\n      }\r\n      \r\n      return result;\r\n    }\r\n    \r\n    console.warn(`Place Details API returned OK but no result for ${placeId}`);\r\n    return null;\r\n  } catch (error) {\r\n    console.error(`Error fetching place details for ${placeId}:`, error.message);\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function fetchPlacesForQuery(query, apiKey) {\r\n  // Try new Places API first, fallback to legacy if needed\r\n  try {\r\n    // New Places API (Places API (New))\r\n    const baseUrl = 'https://places.googleapis.com/v1/places:searchText';\r\n    \r\n    const res = await fetch(baseUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Goog-Api-Key': apiKey,\r\n      },\r\n      body: JSON.stringify({\r\n        textQuery: query,\r\n        maxResultCount: 10,\r\n      }),\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const text = await res.text().catch(() => '');\r\n      // If new API fails, try legacy\r\n      if (res.status === 404 || res.status === 403) {\r\n        console.log(`New Places API not available, trying legacy API for query: \"${query}\"`);\r\n        return await fetchPlacesForQueryLegacy(query, apiKey);\r\n      }\r\n      throw new Error(`Google Places API (New) failed: HTTP ${res.status} - ${text}`);\r\n    }\r\n\r\n    const data = await res.json();\r\n    \r\n    // Convert new API format to legacy format for compatibility\r\n    if (data.places && Array.isArray(data.places)) {\r\n      return data.places.map(place => ({\r\n        name: place.displayName?.text || place.displayName,\r\n        rating: place.rating,\r\n        user_ratings_total: place.userRatingCount,\r\n        place_id: place.id,\r\n      }));\r\n    }\r\n    \r\n    return [];\r\n  } catch (error) {\r\n    // Fallback to legacy API if new API fails\r\n    console.log(`New Places API error, trying legacy API: ${error.message}`);\r\n    return await fetchPlacesForQueryLegacy(query, apiKey);\r\n  }\r\n}\r\n\r\nasync function fetchPlacesForQueryLegacy(query, apiKey) {\r\n  // Legacy Places API Text Search endpoint (fallback)\r\n  const baseUrl = 'https://maps.googleapis.com/maps/api/place/textsearch/json';\r\n\r\n  const url = new URL(baseUrl);\r\n  url.searchParams.set('query', query);\r\n  url.searchParams.set('key', apiKey);\r\n\r\n  const res = await fetch(url.toString());\r\n  if (!res.ok) {\r\n    const text = await res.text().catch(() => '');\r\n    throw new Error(`Google Places Text Search (Legacy) failed: HTTP ${res.status} - ${text}`);\r\n  }\r\n\r\n  const data = await res.json();\r\n  \r\n  // Check for Google API errors\r\n  if (data.status && data.status !== 'OK' && data.status !== 'ZERO_RESULTS') {\r\n    const errorMsg = data.error_message || data.status;\r\n    console.error(`Google Places API (Legacy) error for query \"${query}\": ${data.status} - ${errorMsg}`);\r\n    throw new Error(`Google Places API (Legacy) error: ${data.status} - ${errorMsg}`);\r\n  }\r\n  \r\n  return Array.isArray(data?.results) ? data.results : [];\r\n}\r\n\r\nasync function mapWithConcurrency(items, limit, fn) {\r\n  const results = new Array(items.length);\r\n  let idx = 0;\r\n\r\n  async function worker() {\r\n    while (idx < items.length) {\r\n      const i = idx++;\r\n      results[i] = await fn(items[i], i);\r\n    }\r\n  }\r\n\r\n  const workers = [];\r\n  const n = Math.max(1, Math.min(limit, items.length));\r\n  for (let i = 0; i < n; i++) workers.push(worker());\r\n  await Promise.all(workers);\r\n  return results;\r\n}\r\n\r\nexport async function onRequest(context) {\r\n  const { request, env } = context;\r\n\r\n  if (request.method === 'OPTIONS') return createCORSResponse();\r\n  if (request.method !== 'GET') return jsonResponse({ error: 'Method not allowed' }, 405);\r\n\r\n  try {\r\n    const url = new URL(request.url);\r\n    const mallId = url.searchParams.get('mall_id') || 'sunway_square';\r\n\r\n    // Cache first (edge cache)\r\n    // Skip cache if nocache parameter is present (for debugging)\r\n    const urlParams = new URL(request.url).searchParams;\r\n    const skipCache = urlParams.get('nocache') === '1';\r\n    \r\n    const cache = caches.default;\r\n    const cacheKey = new Request(url.toString(), { method: 'GET' });\r\n    const cached = skipCache ? null : await cache.match(cacheKey);\r\n    if (cached) return cached;\r\n\r\n    const mallInfo = getMallInfo(mallId);\r\n    const raw = getRestaurantsByMall(mallId);\r\n    const restaurants = (Array.isArray(raw) ? raw : [])\r\n      .map((row) => toRestaurantObject(row, mallId))\r\n      .filter(Boolean);\r\n\r\n    const apiKey = env.GOOGLE_PLACES_API_KEY || env.GOOGLE_API_KEY;\r\n    if (!apiKey) {\r\n      console.error('\u274C GOOGLE_PLACES_API_KEY not found in environment variables');\r\n      console.error('Available env keys:', Object.keys(env).filter(k => k.includes('GOOGLE') || k.includes('API')));\r\n      // Still return the base list (graceful degradation) so UI can render.\r\n      const fallback = {\r\n        mall: { id: mallId, name: mallInfo?.name, display_name: mallInfo?.display_name },\r\n        source: 'static_only',\r\n        cached_ttl_seconds: CACHE_TTL_SECONDS,\r\n        restaurants: restaurants.map((r) => ({\r\n          name: r.name,\r\n          unit: r.unit || null,\r\n          floor: r.floor || null,\r\n          category: r.category || 'Unknown',\r\n          logo: r.logo || null,\r\n          rating: null,\r\n          reviews: null,\r\n          google: null,\r\n        })),\r\n      };\r\n\r\n      const headers = new Headers();\r\n      headers.set('Content-Type', 'application/json');\r\n      headers.set('Cache-Control', `public, max-age=${CACHE_TTL_SECONDS}`);\r\n      return new Response(JSON.stringify(fallback), { status: 200, headers });\r\n    }\r\n\r\n    const mallQueryName = mallInfo?.display_name || mallInfo?.name || mallId;\r\n\r\n    // Per-restaurant search gives much better coverage than \"restaurants in mall\" for long mall lists.\r\n    // Concurrency is limited to avoid hitting Cloudflare's \"Too many subrequests\" limit (typically 50 per request).\r\n    // With 66 restaurants, we need to keep concurrency low (2) to stay under the limit.\r\n    // Track errors for debugging\r\n    const errors = [];\r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    let subrequestLimitHit = false; // Track if we've hit the subrequest limit\r\n    \r\n    // Reduced concurrency from 6 to 2 to avoid \"Too many subrequests\" error\r\n    // Each restaurant may make 1-2 API calls (Place Details + possibly Text Search fallback)\r\n    // With 66 restaurants and concurrency of 2, we'll make ~66-132 subrequests, which is close to the limit\r\n    const enriched = await mapWithConcurrency(restaurants, 2, async (r) => {\r\n      try {\r\n        // First, check if we have a place_id mapping for this restaurant\r\n        const placeId = getPlaceId(r.name, mallId);\r\n        let match = null;\r\n        let debugInfo = null;\r\n        \r\n        if (placeId) {\r\n          // Use Place Details API for exact match\r\n          console.log(`Looking up place_id for \"${r.name}\": ${placeId}, apiKey present: ${!!apiKey}`);\r\n          match = await fetchPlaceDetails(placeId, apiKey);\r\n          if (match) {\r\n            // Even if rating is null/undefined, we found the place, so count as success\r\n            // Some places might not have ratings yet\r\n            if (match.rating !== null && match.rating !== undefined) {\r\n              successCount++;\r\n              console.log(`\u2705 Place Details API success for \"${r.name}\": rating=${match.rating}, reviews=${match.user_ratings_total}`);\r\n            } else {\r\n              // Place found but no rating - still count as found\r\n              console.log(`\u26A0\uFE0F Place found for \"${r.name}\" but no rating available (place_id: ${placeId})`);\r\n              debugInfo = { method: 'place_details', place_id: placeId, found: true, has_rating: false };\r\n            }\r\n            return {\r\n              ...r,\r\n              rating: typeof match.rating === 'number' ? match.rating : null,\r\n              reviews: typeof match.user_ratings_total === 'number' ? match.user_ratings_total : null,\r\n              google: {\r\n                place_id: match.place_id || placeId,\r\n                name: match.name || null,\r\n              },\r\n              _debug: debugInfo || { method: 'place_details', place_id: placeId, found: true, has_rating: true },\r\n            };\r\n          } else {\r\n            // Place Details API failed, will fallback to text search\r\n            // Check if it's a \"Too many subrequests\" error (Cloudflare limit)\r\n            const isSubrequestLimit = match === null && placeId; // If match is null, it might be due to subrequest limit\r\n            \r\n            console.error(`\u274C Place Details API failed for \"${r.name}\" (place_id: ${placeId})`);\r\n            console.error(`   - apiKey present: ${!!apiKey}`);\r\n            console.error(`   - apiKey length: ${apiKey ? apiKey.length : 0}`);\r\n            if (isSubrequestLimit) {\r\n              console.error(`   - \u26A0\uFE0F Likely hit Cloudflare \"Too many subrequests\" limit`);\r\n              subrequestLimitHit = true; // Mark that we've hit the limit\r\n            }\r\n            \r\n            // If we've hit the subrequest limit, skip text search fallback to save API calls\r\n            if (subrequestLimitHit) {\r\n              console.error(`   - Skipping text search fallback (subrequest limit reached)`);\r\n              debugInfo = { \r\n                method: 'place_details', \r\n                place_id: placeId, \r\n                found: false, \r\n                fallback: 'skipped_due_to_limit',\r\n                apiKey_present: !!apiKey,\r\n                apiKey_length: apiKey ? apiKey.length : 0,\r\n                error: 'Too many subrequests (Cloudflare limit)'\r\n              };\r\n              return {\r\n                ...r,\r\n                rating: null,\r\n                reviews: null,\r\n                google: null,\r\n                _debug: debugInfo,\r\n              };\r\n            }\r\n            \r\n            console.error(`   - Falling back to text search`);\r\n            debugInfo = { \r\n              method: 'place_details', \r\n              place_id: placeId, \r\n              found: false, \r\n              fallback: 'text_search',\r\n              apiKey_present: !!apiKey,\r\n              apiKey_length: apiKey ? apiKey.length : 0,\r\n              error: isSubrequestLimit ? 'Too many subrequests (Cloudflare limit)' : 'Unknown'\r\n            };\r\n          }\r\n        }\r\n        \r\n        // Fallback to text search if no place_id or place_id lookup failed\r\n        // Skip if we've hit the subrequest limit\r\n        if (subrequestLimitHit && !placeId) {\r\n          console.log(`Skipping text search for \"${r.name}\" (subrequest limit reached)`);\r\n          return {\r\n            ...r,\r\n            rating: null,\r\n            reviews: null,\r\n            google: null,\r\n            _debug: { method: 'text_search', found: false, skipped: 'subrequest_limit' },\r\n          };\r\n        }\r\n        // Try multiple query variations to improve match rate\r\n        const queries = [\r\n          `${r.name} ${mallQueryName}`,\r\n          `${r.name} Sunway Square`,\r\n          r.name, // Just the restaurant name\r\n        ];\r\n        \r\n        let candidates = [];\r\n        for (const query of queries) {\r\n          try {\r\n            const results = await fetchPlacesForQuery(query, apiKey);\r\n            candidates = candidates.concat(results);\r\n            // If we found results, break early\r\n            if (results.length > 0) break;\r\n          } catch (e) {\r\n            // Continue to next query if this one fails\r\n            continue;\r\n          }\r\n        }\r\n        \r\n        // Remove duplicates based on place_id\r\n        const uniqueCandidates = [];\r\n        const seenPlaceIds = new Set();\r\n        for (const candidate of candidates) {\r\n          const pid = candidate.place_id;\r\n          if (pid && !seenPlaceIds.has(pid)) {\r\n            seenPlaceIds.add(pid);\r\n            uniqueCandidates.push(candidate);\r\n          } else if (!pid) {\r\n            // Include candidates without place_id (shouldn't happen, but just in case)\r\n            uniqueCandidates.push(candidate);\r\n          }\r\n        }\r\n        \r\n        match = pickBestMatch(r.name, uniqueCandidates);\r\n        \r\n        if (match) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n          // Log first few failures for debugging\r\n          if (errorCount <= 3) {\r\n            console.log(`No match found for \"${r.name}\" - found ${candidates.length} candidates`);\r\n          }\r\n        }\r\n        \r\n        return {\r\n          ...r,\r\n          rating: typeof match?.rating === 'number' ? match.rating : null,\r\n          reviews: typeof match?.user_ratings_total === 'number' ? match.user_ratings_total : null,\r\n          google: match\r\n            ? {\r\n                place_id: match.place_id || null,\r\n                name: match.name || null,\r\n              }\r\n            : null,\r\n          _debug: debugInfo || (placeId ? { method: 'place_details', place_id: placeId, found: false } : { method: 'text_search', found: match !== null }),\r\n        };\r\n      } catch (e) {\r\n        errorCount++;\r\n        const errorMsg = e.message || String(e);\r\n        errors.push({ restaurant: r.name, error: errorMsg });\r\n        \r\n        // Check if it's a \"Too many subrequests\" error\r\n        if (errorMsg.includes('Too many subrequests')) {\r\n          console.error(`\u26A0\uFE0F Cloudflare subrequest limit reached for \"${r.name}\". This is a Cloudflare Pages limit (typically 50 subrequests per request).`);\r\n          console.error(`   Consider reducing concurrency or implementing request batching.`);\r\n        } else {\r\n          // Log first few errors for debugging\r\n          if (errors.length <= 3) {\r\n            console.error(`Error fetching Places data for \"${r.name}\":`, errorMsg);\r\n          }\r\n        }\r\n        return { ...r, rating: null, reviews: null, google: null };\r\n      }\r\n    });\r\n    \r\n    // Log summary\r\n    console.log(`Leaderboard enrichment complete: ${successCount} matched, ${errorCount} failed, ${errors.length} errors`);\r\n    if (errors.length > 0 && errors.length <= 5) {\r\n      console.error('Sample errors:', errors);\r\n    }\r\n\r\n    // Count how many restaurants have ratings\r\n    const withRatings = enriched.filter(r => r.rating !== null).length;\r\n    const total = enriched.length;\r\n    \r\n    // Remove _debug from restaurants for cleaner response (optional - comment out if you want to see debug info)\r\n    const restaurantsClean = enriched.map(({ _debug, ...rest }) => rest);\r\n    \r\n    const body = {\r\n      mall: { id: mallId, name: mallInfo?.name, display_name: mallInfo?.display_name },\r\n      source: 'google_places_textsearch_per_restaurant',\r\n      cached_ttl_seconds: CACHE_TTL_SECONDS,\r\n      restaurants: restaurantsClean,\r\n      _debug: {\r\n        total_restaurants: total,\r\n        restaurants_with_ratings: withRatings,\r\n        restaurants_without_ratings: total - withRatings,\r\n        // Include debug info for restaurants without ratings (for troubleshooting)\r\n        restaurants_without_ratings_debug: enriched\r\n          .filter(r => r.rating === null)\r\n          .map(r => ({\r\n            name: r.name,\r\n            has_place_id: !!getPlaceId(r.name, mallId),\r\n            place_id: getPlaceId(r.name, mallId),\r\n            debug: r._debug,\r\n          })),\r\n      },\r\n    };\r\n\r\n    const headers = new Headers();\r\n    headers.set('Content-Type', 'application/json');\r\n    headers.set('Cache-Control', `public, max-age=${CACHE_TTL_SECONDS}`);\r\n    headers.set('Vary', 'Accept-Encoding');\r\n\r\n    // Ensure CORS headers are present (jsonResponse helper would do it, but we need a cacheable Response instance).\r\n    headers.set('Access-Control-Allow-Origin', '*');\r\n    headers.set('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');\r\n    headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');\r\n    headers.set('Access-Control-Max-Age', '86400');\r\n\r\n    const response = new Response(JSON.stringify(body), { status: 200, headers });\r\n    context.waitUntil(cache.put(cacheKey, response.clone()));\r\n    return response;\r\n  } catch (error) {\r\n    console.error('Error in leaderboard endpoint:', error);\r\n    return jsonResponse(\r\n      {\r\n        error: 'Internal server error',\r\n        message: error.message,\r\n      },\r\n      500\r\n    );\r\n  }\r\n}\r\n\r\n\r\n", "// GET /api/malls\r\n// Get all available shopping malls\r\n\r\nimport { getAvailableMalls, getMallInfo } from './lib/restaurants.js';\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\n\r\nexport async function onRequest(context) {\r\n  const { request } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  // Only allow GET requests\r\n  if (request.method !== 'GET') {\r\n    return jsonResponse({ error: 'Method not allowed' }, 405);\r\n  }\r\n\r\n  try {\r\n    const malls = [];\r\n    const mallIds = getAvailableMalls();\r\n    \r\n    for (const mallId of mallIds) {\r\n      const info = getMallInfo(mallId);\r\n      malls.push({\r\n        id: mallId,\r\n        name: info.name,\r\n        display_name: info.display_name\r\n      });\r\n    }\r\n\r\n    return jsonResponse({ malls });\r\n  } catch (error) {\r\n    console.error('Error fetching malls:', error);\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n", "// GET /api/restaurants?categories=<categories>&mall_id=<mall_id>&dietary_need=<dietary_need>\r\n// Get restaurants, optionally filtered by categories (comma-separated), mall, and dietary need\r\n\r\nimport { getRestaurantsByCategories, getAllCategories } from './lib/restaurants.js';\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\n\r\nexport async function onRequest(context) {\r\n  const { request } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  // Only allow GET requests\r\n  if (request.method !== 'GET') {\r\n    return jsonResponse({ error: 'Method not allowed' }, 405);\r\n  }\r\n\r\n  try {\r\n    const url = new URL(request.url);\r\n    const mallId = url.searchParams.get('mall_id') || 'sunway_square';\r\n    const dietaryNeed = url.searchParams.get('dietary_need') || 'any';\r\n    let restaurants;\r\n\r\n    const categoriesParam = url.searchParams.get('categories');\r\n    if (categoriesParam) {\r\n      // Filter by categories and dietary need\r\n      const categoryList = categoriesParam.split(',').map(c => c.trim());\r\n      restaurants = getRestaurantsByCategories(categoryList, mallId, dietaryNeed);\r\n    } else {\r\n      // Get all restaurants with dietary filter\r\n      const allCategories = getAllCategories(mallId);\r\n      restaurants = getRestaurantsByCategories(allCategories, mallId, dietaryNeed);\r\n    }\r\n\r\n    return jsonResponse({\r\n      restaurants,\r\n      count: restaurants.length\r\n    });\r\n  } catch (error) {\r\n    console.error('Error fetching restaurants:', error);\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n", "// POST /api/spin\r\n// Spin the wheel and return a random restaurant from selected categories\r\n\r\nimport { getRestaurantsByCategories, getGoogleMapsLink } from './lib/restaurants.js';\r\nimport { getD1Database, generateUUID, getCurrentTimestamp } from './lib/d1.js';\r\nimport { createCORSResponse, jsonResponse } from './lib/cors.js';\r\n\r\nexport async function onRequest(context) {\r\n  const { request, env } = context;\r\n\r\n  // Handle preflight OPTIONS requests\r\n  if (request.method === 'OPTIONS') {\r\n    return createCORSResponse();\r\n  }\r\n\r\n  // Only allow POST requests\r\n  if (request.method !== 'POST') {\r\n    return jsonResponse({ error: 'Method not allowed' }, 405);\r\n  }\r\n\r\n  try {\r\n    // Parse request body\r\n    let body;\r\n    try {\r\n      body = await request.json();\r\n    } catch (e) {\r\n      return jsonResponse({ detail: 'Invalid JSON in request body' }, 400);\r\n    }\r\n    \r\n    if (!body || !body.selected_categories || body.selected_categories.length === 0) {\r\n      return jsonResponse({ detail: 'At least one category must be selected' }, 400);\r\n    }\r\n\r\n    const mallId = body.mall_id || 'sunway_square';\r\n    const selectedCategories = body.selected_categories;\r\n\r\n    // Get all restaurants in the selected categories for the specified mall\r\n    const availableRestaurants = getRestaurantsByCategories(selectedCategories, mallId);\r\n\r\n    if (availableRestaurants.length === 0) {\r\n      return jsonResponse({ detail: 'No restaurants found in selected categories' }, 400);\r\n    }\r\n\r\n    // Random selection with equal probability\r\n    const selectedRestaurant = availableRestaurants[Math.floor(Math.random() * availableRestaurants.length)];\r\n\r\n    // Log the spin to D1 database\r\n    try {\r\n      const db = getD1Database(env);\r\n      const spinId = generateUUID();\r\n      const timestamp = getCurrentTimestamp();\r\n      \r\n      // Insert spin log into D1\r\n      const result = await db.prepare(\r\n        `INSERT INTO spin_logs (\r\n          id, restaurant_name, restaurant_unit, restaurant_floor,\r\n          category, dietary_need, timestamp, mall_id, selected_categories, created_at\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\r\n      ).bind(\r\n        spinId,\r\n        selectedRestaurant.name,\r\n        selectedRestaurant.unit || null,\r\n        selectedRestaurant.floor || null,\r\n        selectedRestaurant.category,\r\n        body.dietary_need || 'any',\r\n        timestamp,\r\n        mallId,\r\n        JSON.stringify(selectedCategories),\r\n        timestamp\r\n      ).run();\r\n\r\n      if (!result.success) {\r\n        console.error('Database error:', result.error);\r\n        // Continue even if database insert fails\r\n      }\r\n\r\n      return jsonResponse({\r\n        restaurant_name: selectedRestaurant.name,\r\n        restaurant_unit: selectedRestaurant.unit,\r\n        restaurant_floor: selectedRestaurant.floor,\r\n        category: selectedRestaurant.category,\r\n        timestamp: new Date(timestamp * 1000).toISOString(),\r\n        spin_id: spinId,\r\n        logo: selectedRestaurant.logo,\r\n        google_maps_link: getGoogleMapsLink(selectedRestaurant.name, mallId)\r\n      });\r\n    } catch (dbError) {\r\n      console.error('Database error:', dbError);\r\n      // Return result even if database insert fails\r\n      return jsonResponse({\r\n        restaurant_name: selectedRestaurant.name,\r\n        restaurant_unit: selectedRestaurant.unit,\r\n        restaurant_floor: selectedRestaurant.floor,\r\n        category: selectedRestaurant.category,\r\n        timestamp: new Date().toISOString(),\r\n        spin_id: null,\r\n        logo: selectedRestaurant.logo,\r\n        google_maps_link: getGoogleMapsLink(selectedRestaurant.name, mallId)\r\n      });\r\n    }\r\n  } catch (error) {\r\n    console.error('Error in spin endpoint:', error);\r\n    return jsonResponse({\r\n      error: 'Internal server error',\r\n      message: error.message,\r\n    }, 500);\r\n  }\r\n}\r\n\r\n", "import { onRequestGet as __api_users_js_onRequestGet } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\users.js\"\nimport { onRequestPost as __api_users_js_onRequestPost } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\users.js\"\nimport { onRequest as __api_categories_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\categories.js\"\nimport { onRequest as __api_health_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\health.js\"\nimport { onRequest as __api_leaderboard_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\leaderboard.js\"\nimport { onRequest as __api_malls_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\malls.js\"\nimport { onRequest as __api_restaurants_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\restaurants.js\"\nimport { onRequest as __api_spin_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\spin.js\"\nimport { onRequest as __api_users_js_onRequest } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\functions\\\\api\\\\users.js\"\n\nexport const routes = [\n    {\n      routePath: \"/api/users\",\n      mountPath: \"/api\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_users_js_onRequestGet],\n    },\n  {\n      routePath: \"/api/users\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_users_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/categories\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_categories_js_onRequest],\n    },\n  {\n      routePath: \"/api/health\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_health_js_onRequest],\n    },\n  {\n      routePath: \"/api/leaderboard\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_leaderboard_js_onRequest],\n    },\n  {\n      routePath: \"/api/malls\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_malls_js_onRequest],\n    },\n  {\n      routePath: \"/api/restaurants\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_restaurants_js_onRequest],\n    },\n  {\n      routePath: \"/api/spin\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_spin_js_onRequest],\n    },\n  {\n      routePath: \"/api/users\",\n      mountPath: \"/api\",\n      method: \"\",\n      middlewares: [],\n      modules: [__api_users_js_onRequest],\n    },\n  ]", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import { match } from \"path-to-regexp\";\n\n//note: this explicitly does not include the * character, as pages requires this\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\n\ntype HTTPMethod =\n\t| \"HEAD\"\n\t| \"OPTIONS\"\n\t| \"GET\"\n\t| \"POST\"\n\t| \"PUT\"\n\t| \"PATCH\"\n\t| \"DELETE\";\n\n/* TODO: Grab these from @cloudflare/workers-types instead */\ntype Params<P extends string = string> = Record<P, string | string[]>;\n\ntype EventContext<Env, P extends string, Data> = {\n\trequest: Request;\n\tfunctionPath: string;\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\n\tparams: Params<P>;\n\tdata: Data;\n};\n\ndeclare type PagesFunction<\n\tEnv = unknown,\n\tP extends string = string,\n\tData extends Record<string, unknown> = Record<string, unknown>,\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\n/* end @cloudflare/workers-types */\n\ntype RouteHandler = {\n\troutePath: string;\n\tmountPath: string;\n\tmethod?: HTTPMethod;\n\tmodules: PagesFunction[];\n\tmiddlewares: PagesFunction[];\n};\n\n// inject `routes` via ESBuild\ndeclare const routes: RouteHandler[];\n// define `__FALLBACK_SERVICE__` via ESBuild\ndeclare const __FALLBACK_SERVICE__: string;\n\n// expect an ASSETS fetcher binding pointing to the asset-server stage\ntype FetchEnv = {\n\t[name: string]: { fetch: typeof fetch };\n\tASSETS: { fetch: typeof fetch };\n};\n\ntype WorkerContext = {\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n};\n\nfunction* executeRequest(request: Request) {\n\tconst requestPath = new URL(request.url).pathname;\n\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\n\tfor (const route of [...routes].reverse()) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult) {\n\t\t\tfor (const handler of route.middlewares.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: mountMatchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Then look for the first exact route match and execute its \"modules\"\n\tfor (const route of routes) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: true,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\n\t\t\tfor (const handler of route.modules.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: matchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default {\n\tasync fetch(\n\t\toriginalRequest: Request,\n\t\tenv: FetchEnv,\n\t\tworkerContext: WorkerContext\n\t) {\n\t\tlet request = originalRequest;\n\t\tconst handlerIterator = executeRequest(request);\n\t\tlet data = {}; // arbitrary data the user can set between functions\n\t\tlet isFailOpen = false;\n\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\n\t\t\tif (input !== undefined) {\n\t\t\t\tlet url = input;\n\t\t\t\tif (typeof input === \"string\") {\n\t\t\t\t\turl = new URL(input, request.url).toString();\n\t\t\t\t}\n\t\t\t\trequest = new Request(url, init);\n\t\t\t}\n\n\t\t\tconst result = handlerIterator.next();\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\n\t\t\tif (result.done === false) {\n\t\t\t\tconst { handler, params, path } = result.value;\n\t\t\t\tconst context = {\n\t\t\t\t\trequest: new Request(request.clone()),\n\t\t\t\t\tfunctionPath: path,\n\t\t\t\t\tnext,\n\t\t\t\t\tparams,\n\t\t\t\t\tget data() {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t},\n\t\t\t\t\tset data(value) {\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\n\t\t\t\t\t\tdata = value;\n\t\t\t\t\t},\n\t\t\t\t\tenv,\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\n\t\t\t\t\tpassThroughOnException: () => {\n\t\t\t\t\t\tisFailOpen = true;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst response = await handler(context);\n\n\t\t\t\tif (!(response instanceof Response)) {\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\n\t\t\t\t}\n\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else if (__FALLBACK_SERVICE__) {\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else {\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\n\t\t\t\tconst response = await fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\treturn await next();\n\t\t} catch (error) {\n\t\t\tif (isFailOpen) {\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t},\n};\n\n// This makes a Response mutable\nconst cloneResponse = (response: Response) =>\n\t// https://fetch.spec.whatwg.org/#null-body-status\n\tnew Response(\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\n\t\tresponse\n\t);\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\User\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\User\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\User\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\User\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\.wrangler\\\\tmp\\\\bundle-Bp5THN\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\User\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\WheelEatNew\\\\WheelEat\\\\.wrangler\\\\tmp\\\\bundle-Bp5THN\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\WheelEatNew\\\\WheelEat\\\\.wrangler\\\\tmp\\\\bundle-Bp5THN\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": ";;;;AAAA,IAAM,OAAO,oBAAI,IAAI;AAErB,SAAS,SAAS,SAAS,MAAM;AAChC,QAAM,MACL,mBAAmB,MAChB,UACA,IAAI;AAAA,KACH,OAAO,YAAY,WACjB,IAAI,QAAQ,SAAS,IAAI,IACzB,SACD;AAAA,EACH;AACH,MAAI,IAAI,QAAQ,IAAI,SAAS,SAAS,IAAI,aAAa,UAAU;AAChE,QAAI,CAAC,KAAK,IAAI,IAAI,SAAS,CAAC,GAAG;AAC9B,WAAK,IAAI,IAAI,SAAS,CAAC;AACvB,cAAQ;AAAA,QACP;AAAA,KACO,IAAI,SAAS,CAAC;AAAA;AAAA,MACtB;AAAA,IACD;AAAA,EACD;AACD;AAnBS;AAqBT,WAAW,QAAQ,IAAI,MAAM,WAAW,OAAO;AAAA,EAC9C,MAAM,QAAQ,SAAS,UAAU;AAChC,UAAM,CAAC,SAAS,IAAI,IAAI;AACxB,aAAS,SAAS,IAAI;AACtB,WAAO,QAAQ,MAAM,QAAQ,SAAS,QAAQ;AAAA,EAC/C;AACD,CAAC;;;ACzBM,SAAS,cAAc,KAAK;AACjC,QAAM,KAAK,IAAI;AAEf,MAAI,CAAC,IAAI;AACP,UAAM,IAAI;AAAA,MACR;AAAA,IAEF;AAAA,EACF;AAEA,SAAO;AACT;AAXgB;AAcT,SAAS,eAAe;AAC7B,SAAO,OAAO,WAAW;AAC3B;AAFgB;AAKT,SAAS,sBAAsB;AACpC,SAAO,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AACrC;AAFgB;;;ACpBT,SAAS,eAAe,SAAS;AACtC,UAAQ,IAAI,+BAA+B,GAAG;AAC9C,UAAQ,IAAI,gCAAgC,oBAAoB;AAChE,UAAQ,IAAI,gCAAgC,6BAA6B;AACzE,UAAQ,IAAI,0BAA0B,OAAO;AAC/C;AALgB;AAOT,SAAS,qBAAqB;AACnC,QAAM,UAAU,IAAI,QAAQ;AAC5B,iBAAe,OAAO;AACtB,SAAO,IAAI,SAAS,MAAM,EAAE,QAAQ,KAAK,QAAQ,CAAC;AACpD;AAJgB;AAMT,SAAS,aAAa,MAAM,SAAS,KAAK;AAC/C,QAAM,UAAU,IAAI,QAAQ;AAC5B,iBAAe,OAAO;AACtB,UAAQ,IAAI,gBAAgB,kBAAkB;AAC9C,SAAO,IAAI,SAAS,KAAK,UAAU,IAAI,GAAG,EAAE,QAAQ,QAAQ,CAAC;AAC/D;AALgB;;;ACThB,eAAsB,aAAa,SAAS;AAC1C,QAAM,EAAE,SAAS,IAAI,IAAI;AAGzB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAEA,MAAI;AAEF,UAAM,KAAK,cAAc,GAAG;AAC5B,UAAMA,UAAS,MAAM,GAAG;AAAA,MACtB;AAAA,IACF,EAAE,IAAI;AAEN,QAAI,CAACA,QAAO,SAAS;AACnB,cAAQ,MAAM,mBAAmBA,QAAO,KAAK;AAC7C,aAAO,aAAa;AAAA,QAClB,OAAO;AAAA,QACP,SAASA,QAAO,OAAO,WAAW;AAAA,QAClC,MAAM;AAAA,MACR,GAAG,GAAG;AAAA,IACR;AAEA,WAAO,aAAa;AAAA,MAClB,SAAS;AAAA,MACT,OAAOA,QAAO,UAAUA,QAAO,QAAQ,SAAS;AAAA,MAChD,OAAOA,QAAO,WAAW,CAAC;AAAA,IAC5B,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,cAAc,KAAK;AACjC,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AApCsB;AAuCtB,eAAsB,cAAc,SAAS;AAC3C,QAAM,EAAE,SAAS,IAAI,IAAI;AAGzB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAEA,MAAI;AAEF,QAAI;AACJ,QAAI;AACF,aAAO,MAAM,QAAQ,KAAK;AAAA,IAC5B,SAAS,GAAG;AACV,aAAO,aAAa,EAAE,OAAO,+BAA+B,GAAG,GAAG;AAAA,IACpE;AAGA,QAAI,CAAC,KAAK,MAAM,CAAC,KAAK,OAAO;AAC3B,aAAO,aAAa;AAAA,QAClB,OAAO;AAAA,QACP,SAAS;AAAA,MACX,GAAG,GAAG;AAAA,IACR;AAEA,UAAM,KAAK,cAAc,GAAG;AAC5B,UAAM,YAAY,oBAAoB;AAGtC,UAAM,eAAe,MAAM,GAAG;AAAA,MAC5B;AAAA,IACF,EAAE,KAAK,KAAK,IAAI,KAAK,KAAK,EAAE,MAAM;AAElC,QAAI,cAAc;AAEhB,YAAMA,UAAS,MAAM,GAAG;AAAA,QACtB;AAAA;AAAA;AAAA,MAGF,EAAE;AAAA,QACA,KAAK,QAAQ,aAAa;AAAA,QAC1B,KAAK;AAAA,QACL;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,MACP,EAAE,IAAI;AAEN,UAAI,CAACA,QAAO,SAAS;AACnB,gBAAQ,MAAM,0BAA0BA,QAAO,KAAK;AACpD,eAAO,aAAa;AAAA,UAClB,OAAO;AAAA,UACP,SAASA,QAAO,OAAO,WAAW;AAAA,QACpC,GAAG,GAAG;AAAA,MACR;AAGA,YAAM,cAAc,MAAM,GAAG;AAAA,QAC3B;AAAA,MACF,EAAE,KAAK,KAAK,IAAI,KAAK,KAAK,EAAE,MAAM;AAElC,aAAO,aAAa;AAAA,QAClB,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,MAAM;AAAA,MACR,CAAC;AAAA,IACH,OAAO;AAEL,YAAMA,UAAS,MAAM,GAAG;AAAA,QACtB;AAAA;AAAA,MAEF,EAAE;AAAA,QACA,KAAK;AAAA,QACL,KAAK,QAAQ;AAAA,QACb,KAAK;AAAA,QACL;AAAA,QACA;AAAA,MACF,EAAE,IAAI;AAEN,UAAI,CAACA,QAAO,SAAS;AACnB,gBAAQ,MAAM,0BAA0BA,QAAO,KAAK;AACpD,eAAO,aAAa;AAAA,UAClB,OAAO;AAAA,UACP,SAASA,QAAO,OAAO,WAAW;AAAA,QACpC,GAAG,GAAG;AAAA,MACR;AAGA,YAAM,UAAU,MAAM,GAAG;AAAA,QACvB;AAAA,MACF,EAAE,KAAK,KAAK,EAAE,EAAE,MAAM;AAEtB,aAAO,aAAa;AAAA,QAClB,SAAS;AAAA,QACT,QAAQ;AAAA,QACR,MAAM;AAAA,MACR,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,cAAc,KAAK;AACjC,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AAxGsB;AA2GtB,eAAsB,UAAU,SAAS;AACvC,QAAM,EAAE,QAAQ,IAAI;AAEpB,MAAI,QAAQ,WAAW,OAAO;AAC5B,WAAO,aAAa,OAAO;AAAA,EAC7B,WAAW,QAAQ,WAAW,QAAQ;AACpC,WAAO,cAAc,OAAO;AAAA,EAC9B,WAAW,QAAQ,WAAW,WAAW;AACvC,WAAO,mBAAmB;AAAA,EAC5B,OAAO;AACL,WAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAAA,EAC1D;AACF;AAZsB;;;ACrJf,IAAM,uBAAuB;AAAA,EAClC,eAAe;AAAA,IACb,cAAc;AAAA,IACd,YAAY;AAAA,IACZ,sBAAsB;AAAA,IACtB,WAAW;AAAA,IACX,gBAAgB;AAAA,IAChB,kBAAkB;AAAA,IAClB,UAAU;AAAA,IACV,iBAAiB;AAAA,IACjB,UAAU;AAAA,IACV,eAAe;AAAA,IACf,2BAA2B;AAAA,IAC3B,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,qBAAqB;AAAA,IACrB,uBAAuB;AAAA,IACvB,aAAa;AAAA,IACb,QAAQ;AAAA,IACR,gBAAgB;AAAA,IAChB,cAAc;AAAA,IACd,iBAAiB;AAAA,IACjB,kBAAkB;AAAA,IAClB,0BAA0B;AAAA,IAC1B,YAAY;AAAA,IACZ,qBAAqB;AAAA,IACrB,eAAe;AAAA,IACf,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,4BAA4B;AAAA,IAC5B,WAAW;AAAA,IACX,WAAW;AAAA,IACX,mBAAmB;AAAA,IACnB,qBAAqB;AAAA,IACrB,sBAAsB;AAAA,IACtB,aAAa;AAAA,IACb,UAAU;AAAA,IACV,UAAU;AAAA,IACV,aAAa;AAAA,IACb,UAAU;AAAA,IACV,eAAe;AAAA,IACf,mBAAmB;AAAA,IACnB,6CAA6C;AAAA,IAC7C,gBAAgB;AAAA,IAChB,eAAe;AAAA,IACf,sBAAsB;AAAA,IACtB,aAAa;AAAA,IACb,aAAa;AAAA,IACb,oBAAoB;AAAA,IACpB,WAAW;AAAA,IACX,iBAAiB;AAAA,IACjB,gBAAgB;AAAA,IAChB,6BAA6B;AAAA,IAC7B,WAAW;AAAA,IACX,UAAU;AAAA,IACV,oBAAoB;AAAA,IACpB,gBAAgB;AAAA,IAChB,yBAAyB;AAAA,IACzB,gCAAgC;AAAA,IAChC,yBAAyB;AAAA,IACzB,kBAAkB;AAAA,IAClB,gBAAgB;AAAA,IAChB,SAAS;AAAA,IACT,qBAAqB;AAAA,IACrB,iBAAiB;AAAA,IACjB,cAAc;AAAA,IACd,oBAAoB;AAAA,EACtB;AACF;AAEO,SAAS,WAAW,gBAAgB,SAAS,iBAAiB;AACnE,SAAO,qBAAqB,MAAM,IAAI,cAAc,KAAK;AAC3D;AAFgB;;;ACtET,IAAM,mBAAmB;AAAA,EAC9B,eAAe;AAAA,IACb,CAAC,cAAc,SAAS,MAAM,kBAAkB,KAAK;AAAA,IACrD,CAAC,YAAY,SAAS,MAAM,qBAAqB,IAAI;AAAA,IACrD,CAAC,sBAAsB,SAAS,MAAM,2BAA2B,KAAK;AAAA,IACtE,CAAC,WAAW,SAAS,MAAM,4BAA4B,KAAK;AAAA,IAC5D,CAAC,gBAAgB,SAAS,MAAM,2BAA2B,IAAI;AAAA,IAC/D,CAAC,kBAAkB,iBAAiB,MAAM,uBAAuB,KAAK;AAAA,IACtE,CAAC,UAAU,UAAU,OAAO,mBAAmB,IAAI;AAAA,IACnD,CAAC,iBAAiB,UAAU,OAAO,mBAAmB,IAAI;AAAA,IAC1D,CAAC,UAAU,SAAS,MAAM,mBAAmB,IAAI;AAAA,IACjD,CAAC,eAAe,SAAS,MAAM,kBAAkB,IAAI;AAAA,IACrD,CAAC,2BAA2B,SAAS,MAAM,mBAAmB,IAAI;AAAA,IAClE,CAAC,WAAW,SAAS,MAAM,mBAAmB,IAAI;AAAA,IAClD,CAAC,YAAY,SAAS,MAAM,mBAAmB,IAAI;AAAA,IACnD,CAAC,WAAW,SAAS,MAAM,wBAAwB,KAAK;AAAA,IACxD,CAAC,qBAAqB,SAAS,MAAM,oBAAoB,KAAK;AAAA,IAC9D,CAAC,uBAAuB,iBAAiB,MAAM,uBAAuB,KAAK;AAAA,IAC3E,CAAC,aAAa,UAAU,OAAO,mBAAmB,IAAI;AAAA,IACtD,CAAC,QAAQ,SAAS,MAAM,oBAAoB,KAAK;AAAA,IACjD,CAAC,gBAAgB,UAAU,OAAO,oBAAoB,IAAI;AAAA,IAC1D,CAAC,cAAc,UAAU,MAAM,kBAAkB,IAAI;AAAA,IACrD,CAAC,iBAAiB,UAAU,OAAO,uBAAuB,IAAI;AAAA,IAC9D,CAAC,kBAAkB,SAAS,MAAM,qBAAqB,KAAK;AAAA,IAC5D,CAAC,0BAA0B,SAAS,MAAM,mBAAmB,IAAI;AAAA,IACjE,CAAC,YAAY,SAAS,MAAM,mBAAmB,IAAI;AAAA,IACnD,CAAC,qBAAqB,SAAS,MAAM,qBAAqB,IAAI;AAAA,IAC9D,CAAC,eAAe,SAAS,MAAM,kBAAkB,KAAK;AAAA,IACtD,CAAC,gBAAgB,SAAS,MAAM,qBAAqB,IAAI;AAAA,IACzD,CAAC,aAAa,SAAS,MAAM,2BAA2B,IAAI;AAAA,IAC5D,CAAC,4BAA4B,SAAS,MAAM,qBAAqB,IAAI;AAAA,IACrE,CAAC,WAAW,SAAS,MAAM,2BAA2B,IAAI;AAAA,IAC1D,CAAC,WAAW,SAAS,MAAM,qBAAqB,IAAI;AAAA,IACpD,CAAC,mBAAmB,SAAS,MAAM,kBAAkB,IAAI;AAAA,IACzD,CAAC,qBAAqB,UAAU,OAAO,qBAAqB,IAAI;AAAA,IAChE,CAAC,sBAAsB,UAAU,OAAO,kBAAkB,IAAI;AAAA,IAC9D,CAAC,aAAa,SAAS,MAAM,qBAAqB,IAAI;AAAA,IACtD,CAAC,UAAU,SAAS,MAAM,kBAAkB,IAAI;AAAA,IAChD,CAAC,UAAU,SAAS,MAAM,uBAAuB,KAAK;AAAA,IACtD,CAAC,aAAa,SAAS,MAAM,4BAA4B,KAAK;AAAA,IAC9D,CAAC,UAAU,SAAS,MAAM,uBAAuB,KAAK;AAAA,IACtD,CAAC,eAAe,SAAS,MAAM,oBAAoB,KAAK;AAAA,IACxD,CAAC,mBAAmB,UAAU,OAAO,qBAAqB,IAAI;AAAA,IAC9D,CAAC,6CAA6C,UAAU,OAAO,uBAAuB,KAAK;AAAA,IAC3F,CAAC,gBAAgB,UAAU,OAAO,oBAAoB,IAAI;AAAA,IAC1D,CAAC,eAAe,SAAS,MAAM,oBAAoB,KAAK;AAAA,IACxD,CAAC,sBAAsB,WAAW,OAAO,uBAAuB,KAAK;AAAA,IACrE,CAAC,aAAa,UAAU,OAAO,qBAAqB,IAAI;AAAA,IACxD,CAAC,aAAa,SAAS,MAAM,oBAAoB,KAAK;AAAA,IACtD,CAAC,oBAAoB,UAAU,OAAO,aAAa,IAAI;AAAA,IACvD,CAAC,WAAW,UAAU,OAAO,qBAAqB,IAAI;AAAA,IACtD,CAAC,iBAAiB,SAAS,MAAM,2BAA2B,IAAI;AAAA,IAChE,CAAC,gBAAgB,SAAS,MAAM,mBAAmB,IAAI;AAAA,IACvD,CAAC,6BAA6B,iBAAiB,MAAM,oBAAoB,IAAI;AAAA,IAC7E,CAAC,WAAW,UAAU,OAAO,2BAA2B,IAAI;AAAA,IAC5D,CAAC,UAAU,UAAU,OAAO,aAAa,IAAI;AAAA,IAC7C,CAAC,oBAAoB,SAAS,MAAM,2BAA2B,KAAK;AAAA,IACpE,CAAC,gBAAgB,SAAS,MAAM,mBAAmB,IAAI;AAAA,IACvD,CAAC,yBAAyB,SAAS,MAAM,qBAAqB,IAAI;AAAA,IAClE,CAAC,gCAAgC,SAAS,MAAM,uBAAuB,KAAK;AAAA,IAC5E,CAAC,yBAAyB,UAAU,OAAO,qBAAqB,IAAI;AAAA,IACpE,CAAC,kBAAkB,oBAAoB,OAAO,eAAe,KAAK;AAAA,IAClE,CAAC,gBAAgB,SAAS,MAAM,oBAAoB,KAAK;AAAA,IACzD,CAAC,SAAS,SAAS,MAAM,uBAAuB,KAAK;AAAA,IACrD,CAAC,qBAAqB,UAAU,MAAM,oBAAoB,IAAI;AAAA,IAC9D,CAAC,iBAAiB,UAAU,OAAO,qBAAqB,IAAI;AAAA,IAC5D,CAAC,cAAc,SAAS,MAAM,kBAAkB,IAAI;AAAA,IACpD,CAAC,oBAAoB,SAAS,MAAM,uBAAuB,KAAK;AAAA,EAClE;AACF;AAGO,IAAM,YAAY;AAAA,EACvB,eAAe;AAAA,IACb,MAAM;AAAA,IACN,cAAc;AAAA,EAChB;AACF;AAGA,IAAM,eAAe;AAAA,EACnB,cAAc;AAAA,EACd,YAAY;AAAA,EACZ,sBAAsB;AAAA,EACtB,WAAW;AAAA,EACX,gBAAgB;AAAA,EAChB,kBAAkB;AAAA,EAClB,UAAU;AAAA,EACV,iBAAiB;AAAA,EACjB,UAAU;AAAA,EACV,eAAe;AAAA,EACf,2BAA2B;AAAA,EAC3B,WAAW;AAAA,EACX,YAAY;AAAA,EACZ,WAAW;AAAA,EACX,qBAAqB;AAAA,EACrB,uBAAuB;AAAA,EACvB,aAAa;AAAA,EACb,QAAQ;AAAA,EACR,gBAAgB;AAAA,EAChB,cAAc;AAAA,EACd,iBAAiB;AAAA,EACjB,kBAAkB;AAAA,EAClB,0BAA0B;AAAA,EAC1B,YAAY;AAAA,EACZ,qBAAqB;AAAA,EACrB,eAAe;AAAA,EACf,gBAAgB;AAAA,EAChB,aAAa;AAAA,EACb,4BAA4B;AAAA,EAC5B,WAAW;AAAA,EACX,WAAW;AAAA,EACX,mBAAmB;AAAA,EACnB,qBAAqB;AAAA,EACrB,sBAAsB;AAAA,EACtB,aAAa;AAAA,EACb,UAAU;AAAA,EACV,UAAU;AAAA,EACV,aAAa;AAAA,EACb,UAAU;AAAA,EACV,eAAe;AAAA,EACf,mBAAmB;AAAA,EACnB,6CAA6C;AAAA,EAC7C,gBAAgB;AAAA,EAChB,eAAe;AAAA,EACf,sBAAsB;AAAA,EACtB,aAAa;AAAA,EACb,aAAa;AAAA,EACb,oBAAoB;AAAA,EACpB,WAAW;AAAA,EACX,iBAAiB;AAAA,EACjB,gBAAgB;AAAA,EAChB,6BAA6B;AAAA,EAC7B,WAAW;AAAA,EACX,UAAU;AAAA,EACV,oBAAoB;AAAA,EACpB,gBAAgB;AAAA,EAChB,yBAAyB;AAAA,EACzB,gCAAgC;AAAA,EAChC,yBAAyB;AAAA,EACzB,kBAAkB;AAAA,EAClB,gBAAgB;AAAA,EAChB,SAAS;AAAA,EACT,qBAAqB;AAAA,EACrB,iBAAiB;AAAA,EACjB,cAAc;AAAA,EACd,oBAAoB;AACtB;AAEO,SAAS,YAAY,gBAAgB,SAAS,iBAAiB;AACpE,QAAM,eAAe,aAAa,cAAc;AAChD,MAAI,cAAc;AAChB,WAAO,eAAe,YAAY;AAAA,EACpC;AACA,SAAO;AACT;AANgB;AAQT,SAAS,kBAAkB,gBAAgB,SAAS,iBAAiB;AAC1E,QAAM,UAAU,WAAW,gBAAgB,MAAM;AAEjD,MAAI,SAAS;AACX,WAAO,2BAA2B,OAAO;AAAA,EAC3C;AAEA,SAAO;AACT;AARgB;AAUT,SAAS,oBAAoB;AAClC,SAAO,OAAO,KAAK,gBAAgB;AACrC;AAFgB;AAIT,SAAS,YAAY,QAAQ;AAClC,SAAO,UAAU,MAAM,KAAK,EAAE,MAAM,QAAQ,cAAc,OAAO;AACnE;AAFgB;AAIT,SAAS,qBAAqB,QAAQ;AAC3C,SAAO,iBAAiB,MAAM,KAAK,CAAC;AACtC;AAFgB;AAIT,SAAS,2BAA2B,YAAY,SAAS,iBAAiB,cAAc,OAAO;AACpG,QAAM,cAAc,qBAAqB,MAAM;AAC/C,QAAM,sBAAsB,CAAC;AAE7B,aAAW,cAAc,aAAa;AACpC,UAAM,CAAC,MAAM,MAAM,OAAO,UAAU,OAAO,IAAI;AAG/C,QAAI,CAAC,WAAW,SAAS,QAAQ,GAAG;AAClC;AAAA,IACF;AAGA,QAAI,gBAAgB,qBAAqB,CAAC,SAAS;AACjD;AAAA,IACF;AAEA,UAAM,WAAW,YAAY,MAAM,MAAM;AACzC,wBAAoB,KAAK;AAAA,MACvB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA,MAAM;AAAA,IACR,CAAC;AAAA,EACH;AAEA,SAAO;AACT;AA7BgB;AA+BT,SAAS,iBAAiB,SAAS,iBAAiB;AACzD,QAAM,cAAc,qBAAqB,MAAM;AAC/C,QAAM,aAAa,oBAAI,IAAI;AAE3B,aAAW,cAAc,aAAa;AACpC,eAAW,IAAI,WAAW,CAAC,CAAC;AAAA,EAC9B;AAEA,SAAO,MAAM,KAAK,UAAU,EAAE,KAAK;AACrC;AATgB;;;ACjNhB,eAAsBC,WAAU,SAAS;AACvC,QAAM,EAAE,QAAQ,IAAI;AAGpB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAGA,MAAI,QAAQ,WAAW,OAAO;AAC5B,WAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAAA,EAC1D;AAEA,MAAI;AACF,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,SAAS,IAAI,aAAa,IAAI,SAAS,KAAK;AAClD,UAAM,aAAa,iBAAiB,MAAM;AAE1C,WAAO,aAAa,EAAE,WAAW,CAAC;AAAA,EACpC,SAAS,OAAO;AACd,YAAQ,MAAM,8BAA8B,KAAK;AACjD,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AA1BsB,OAAAA,YAAA;;;ACDtB,eAAsBC,WAAU,SAAS;AACvC,QAAM,EAAE,QAAQ,IAAI;AAGpB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAGA,MAAI,QAAQ,WAAW,OAAO;AAC5B,WAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAAA,EAC1D;AAEA,MAAI;AACF,WAAO,aAAa;AAAA,MAClB,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IACpC,CAAC;AAAA,EACH,SAAS,OAAO;AACd,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AAzBsB,OAAAA,YAAA;;;ACOtB,IAAM,oBAAoB;AAE1B,SAAS,mBAAmB,KAAK,QAAQ;AAEvC,MAAI,CAAC,MAAM,QAAQ,GAAG,EAAG,QAAO;AAChC,QAAM,CAAC,MAAM,MAAM,OAAO,QAAQ,IAAI;AACtC,MAAI,CAAC,KAAM,QAAO;AAClB,SAAO;AAAA,IACL;AAAA,IACA,MAAM,QAAQ;AAAA,IACd,OAAO,SAAS;AAAA,IAChB,UAAU,YAAY;AAAA,IACtB,MAAM,YAAY,MAAM,MAAM;AAAA,EAChC;AACF;AAZS;AAcT,SAAS,cAAc,OAAO;AAC5B,SAAO,OAAO,SAAS,EAAE,EACtB,YAAY,EACZ,QAAQ,MAAM,KAAK,EACnB,QAAQ,eAAe,GAAG,EAC1B,KAAK;AACV;AANS;AAQT,SAAS,SAAS,GAAG;AACnB,QAAM,OAAO,cAAc,CAAC;AAC5B,SAAO,OAAO,KAAK,MAAM,GAAG,EAAE,OAAO,OAAO,IAAI,CAAC;AACnD;AAHS;AAKT,SAAS,WAAW,OAAO,OAAO;AAEhC,QAAM,IAAI,SAAS,KAAK;AACxB,QAAM,IAAI,SAAS,KAAK;AACxB,MAAI,EAAE,WAAW,KAAK,EAAE,WAAW,EAAG,QAAO;AAC7C,QAAM,OAAO,IAAI,IAAI,CAAC;AACtB,QAAM,OAAO,IAAI,IAAI,CAAC;AACtB,MAAI,QAAQ;AACZ,aAAW,KAAK,KAAM,KAAI,KAAK,IAAI,CAAC,EAAG,UAAS;AAChD,QAAM,SAAQ,oBAAI,IAAI,CAAC,GAAG,MAAM,GAAG,IAAI,CAAC,GAAE,QAAQ;AAClD,QAAM,UAAU,QAAQ;AAExB,QAAM,QAAQ,cAAc,KAAK,MAAM,cAAc,KAAK,IAAI,IAAI;AAClE,SAAO,UAAU;AACnB;AAdS;AAgBT,SAAS,cAAc,YAAY,QAAQ;AACzC,QAAM,SAAS,cAAc,UAAU;AACvC,MAAI,CAAC,OAAQ,QAAO;AAEpB,MAAI,OAAO;AACX,MAAI,YAAY;AAChB,aAAW,KAAK,QAAQ;AACtB,UAAM,KAAK,GAAG;AACd,QAAI,CAAC,GAAI;AACT,UAAM,QAAQ,WAAW,YAAY,EAAE;AACvC,QAAI,QAAQ,WAAW;AACrB,kBAAY;AACZ,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO,aAAa,MAAM,OAAO;AACnC;AAjBS;AAyBT,eAAe,kBAAkB,SAAS,QAAQ;AAChD,MAAI,CAAC,WAAW,CAAC,OAAQ,QAAO;AAEhC,MAAI;AAEF,UAAM,UAAU,2CAA2C,OAAO;AAElE,UAAM,MAAM,MAAM,MAAM,SAAS;AAAA,MAC/B,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,kBAAkB;AAAA,QAClB,oBAAoB;AAAA,MACtB;AAAA,IACF,CAAC;AAED,QAAI,IAAI,IAAI;AACV,YAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,aAAO;AAAA,QACL,MAAM,KAAK,aAAa,QAAQ,KAAK;AAAA,QACrC,QAAQ,KAAK;AAAA,QACb,oBAAoB,KAAK;AAAA,QACzB,UAAU,KAAK,MAAM;AAAA,MACvB;AAAA,IACF;AAGA,WAAO,MAAM,wBAAwB,SAAS,MAAM;AAAA,EACtD,SAAS,OAAO;AACd,YAAQ,IAAI,qCAAqC,OAAO,oBAAoB,MAAM,OAAO,EAAE;AAC3F,WAAO,MAAM,wBAAwB,SAAS,MAAM;AAAA,EACtD;AACF;AAhCe;AAwCf,eAAe,wBAAwB,SAAS,QAAQ;AACtD,MAAI,CAAC,WAAW,CAAC,OAAQ,QAAO;AAEhC,MAAI;AACF,UAAM,UAAU;AAChB,UAAM,MAAM,IAAI,IAAI,OAAO;AAC3B,QAAI,aAAa,IAAI,YAAY,OAAO;AACxC,QAAI,aAAa,IAAI,OAAO,MAAM;AAClC,QAAI,aAAa,IAAI,UAAU,yCAAyC;AAExE,YAAQ,IAAI,8BAA8B,OAAO,KAAK;AACtD,QAAI;AACJ,QAAI;AACF,YAAM,MAAM,MAAM,IAAI,SAAS,CAAC;AAAA,IAClC,SAAS,OAAO;AAEd,UAAI,MAAM,WAAW,MAAM,QAAQ,SAAS,sBAAsB,GAAG;AACnE,gBAAQ,MAAM,wDAA8C,OAAO,uDAAuD;AAC1H,cAAM;AAAA,MACR;AACA,YAAM;AAAA,IACR;AAEA,QAAI,CAAC,IAAI,IAAI;AACX,YAAM,OAAO,MAAM,IAAI,KAAK,EAAE,MAAM,MAAM,EAAE;AAC5C,YAAM,IAAI,MAAM,kCAAkC,IAAI,MAAM,MAAM,IAAI,EAAE;AAAA,IAC1E;AAEA,UAAM,OAAO,MAAM,IAAI,KAAK;AAE5B,QAAI,KAAK,WAAW,QAAQ,KAAK,QAAQ;AACvC,aAAO;AAAA,QACL,MAAM,KAAK,OAAO;AAAA,QAClB,QAAQ,KAAK,OAAO;AAAA,QACpB,oBAAoB,KAAK,OAAO;AAAA,QAChC,UAAU,KAAK,OAAO,YAAY;AAAA,MACpC;AAGA,UAAI,OAAO,WAAW,QAAQ,OAAO,WAAW,QAAW;AACzD,gBAAQ,IAAI,wCAAmC,OAAO,YAAY,OAAO,MAAM,aAAa,OAAO,kBAAkB,EAAE;AAAA,MACzH,OAAO;AACL,gBAAQ,IAAI,wCAA8B,OAAO,mCAAmC,OAAO,IAAI,GAAG;AAAA,MACpG;AAEA,aAAO;AAAA,IACT;AAEA,YAAQ,KAAK,mDAAmD,OAAO,EAAE;AACzE,WAAO;AAAA,EACT,SAAS,OAAO;AACd,YAAQ,MAAM,oCAAoC,OAAO,KAAK,MAAM,OAAO;AAC3E,WAAO;AAAA,EACT;AACF;AAtDe;AAwDf,eAAe,oBAAoB,OAAO,QAAQ;AAEhD,MAAI;AAEF,UAAM,UAAU;AAEhB,UAAM,MAAM,MAAM,MAAM,SAAS;AAAA,MAC/B,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,kBAAkB;AAAA,MACpB;AAAA,MACA,MAAM,KAAK,UAAU;AAAA,QACnB,WAAW;AAAA,QACX,gBAAgB;AAAA,MAClB,CAAC;AAAA,IACH,CAAC;AAED,QAAI,CAAC,IAAI,IAAI;AACX,YAAM,OAAO,MAAM,IAAI,KAAK,EAAE,MAAM,MAAM,EAAE;AAE5C,UAAI,IAAI,WAAW,OAAO,IAAI,WAAW,KAAK;AAC5C,gBAAQ,IAAI,+DAA+D,KAAK,GAAG;AACnF,eAAO,MAAM,0BAA0B,OAAO,MAAM;AAAA,MACtD;AACA,YAAM,IAAI,MAAM,wCAAwC,IAAI,MAAM,MAAM,IAAI,EAAE;AAAA,IAChF;AAEA,UAAM,OAAO,MAAM,IAAI,KAAK;AAG5B,QAAI,KAAK,UAAU,MAAM,QAAQ,KAAK,MAAM,GAAG;AAC7C,aAAO,KAAK,OAAO,IAAI,YAAU;AAAA,QAC/B,MAAM,MAAM,aAAa,QAAQ,MAAM;AAAA,QACvC,QAAQ,MAAM;AAAA,QACd,oBAAoB,MAAM;AAAA,QAC1B,UAAU,MAAM;AAAA,MAClB,EAAE;AAAA,IACJ;AAEA,WAAO,CAAC;AAAA,EACV,SAAS,OAAO;AAEd,YAAQ,IAAI,4CAA4C,MAAM,OAAO,EAAE;AACvE,WAAO,MAAM,0BAA0B,OAAO,MAAM;AAAA,EACtD;AACF;AA9Ce;AAgDf,eAAe,0BAA0B,OAAO,QAAQ;AAEtD,QAAM,UAAU;AAEhB,QAAM,MAAM,IAAI,IAAI,OAAO;AAC3B,MAAI,aAAa,IAAI,SAAS,KAAK;AACnC,MAAI,aAAa,IAAI,OAAO,MAAM;AAElC,QAAM,MAAM,MAAM,MAAM,IAAI,SAAS,CAAC;AACtC,MAAI,CAAC,IAAI,IAAI;AACX,UAAM,OAAO,MAAM,IAAI,KAAK,EAAE,MAAM,MAAM,EAAE;AAC5C,UAAM,IAAI,MAAM,mDAAmD,IAAI,MAAM,MAAM,IAAI,EAAE;AAAA,EAC3F;AAEA,QAAM,OAAO,MAAM,IAAI,KAAK;AAG5B,MAAI,KAAK,UAAU,KAAK,WAAW,QAAQ,KAAK,WAAW,gBAAgB;AACzE,UAAM,WAAW,KAAK,iBAAiB,KAAK;AAC5C,YAAQ,MAAM,+CAA+C,KAAK,MAAM,KAAK,MAAM,MAAM,QAAQ,EAAE;AACnG,UAAM,IAAI,MAAM,qCAAqC,KAAK,MAAM,MAAM,QAAQ,EAAE;AAAA,EAClF;AAEA,SAAO,MAAM,QAAQ,MAAM,OAAO,IAAI,KAAK,UAAU,CAAC;AACxD;AAxBe;AA0Bf,eAAe,mBAAmB,OAAO,OAAO,IAAI;AAClD,QAAM,UAAU,IAAI,MAAM,MAAM,MAAM;AACtC,MAAI,MAAM;AAEV,iBAAe,SAAS;AACtB,WAAO,MAAM,MAAM,QAAQ;AACzB,YAAM,IAAI;AACV,cAAQ,CAAC,IAAI,MAAM,GAAG,MAAM,CAAC,GAAG,CAAC;AAAA,IACnC;AAAA,EACF;AALe;AAOf,QAAM,UAAU,CAAC;AACjB,QAAM,IAAI,KAAK,IAAI,GAAG,KAAK,IAAI,OAAO,MAAM,MAAM,CAAC;AACnD,WAAS,IAAI,GAAG,IAAI,GAAG,IAAK,SAAQ,KAAK,OAAO,CAAC;AACjD,QAAM,QAAQ,IAAI,OAAO;AACzB,SAAO;AACT;AAhBe;AAkBf,eAAsBC,WAAU,SAAS;AACvC,QAAM,EAAE,SAAS,IAAI,IAAI;AAEzB,MAAI,QAAQ,WAAW,UAAW,QAAO,mBAAmB;AAC5D,MAAI,QAAQ,WAAW,MAAO,QAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAEtF,MAAI;AACF,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,SAAS,IAAI,aAAa,IAAI,SAAS,KAAK;AAIlD,UAAM,YAAY,IAAI,IAAI,QAAQ,GAAG,EAAE;AACvC,UAAM,YAAY,UAAU,IAAI,SAAS,MAAM;AAE/C,UAAM,QAAQ,OAAO;AACrB,UAAM,WAAW,IAAI,QAAQ,IAAI,SAAS,GAAG,EAAE,QAAQ,MAAM,CAAC;AAC9D,UAAM,SAAS,YAAY,OAAO,MAAM,MAAM,MAAM,QAAQ;AAC5D,QAAI,OAAQ,QAAO;AAEnB,UAAM,WAAW,YAAY,MAAM;AACnC,UAAM,MAAM,qBAAqB,MAAM;AACvC,UAAM,eAAe,MAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,GAC9C,IAAI,CAAC,QAAQ,mBAAmB,KAAK,MAAM,CAAC,EAC5C,OAAO,OAAO;AAEjB,UAAM,SAAS,IAAI,yBAAyB,IAAI;AAChD,QAAI,CAAC,QAAQ;AACX,cAAQ,MAAM,iEAA4D;AAC1E,cAAQ,MAAM,uBAAuB,OAAO,KAAK,GAAG,EAAE,OAAO,OAAK,EAAE,SAAS,QAAQ,KAAK,EAAE,SAAS,KAAK,CAAC,CAAC;AAE5G,YAAM,WAAW;AAAA,QACf,MAAM,EAAE,IAAI,QAAQ,MAAM,UAAU,MAAM,cAAc,UAAU,aAAa;AAAA,QAC/E,QAAQ;AAAA,QACR,oBAAoB;AAAA,QACpB,aAAa,YAAY,IAAI,CAAC,OAAO;AAAA,UACnC,MAAM,EAAE;AAAA,UACR,MAAM,EAAE,QAAQ;AAAA,UAChB,OAAO,EAAE,SAAS;AAAA,UAClB,UAAU,EAAE,YAAY;AAAA,UACxB,MAAM,EAAE,QAAQ;AAAA,UAChB,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,QAAQ;AAAA,QACV,EAAE;AAAA,MACJ;AAEA,YAAMC,WAAU,IAAI,QAAQ;AAC5B,MAAAA,SAAQ,IAAI,gBAAgB,kBAAkB;AAC9C,MAAAA,SAAQ,IAAI,iBAAiB,mBAAmB,iBAAiB,EAAE;AACnE,aAAO,IAAI,SAAS,KAAK,UAAU,QAAQ,GAAG,EAAE,QAAQ,KAAK,SAAAA,SAAQ,CAAC;AAAA,IACxE;AAEA,UAAM,gBAAgB,UAAU,gBAAgB,UAAU,QAAQ;AAMlE,UAAM,SAAS,CAAC;AAChB,QAAI,eAAe;AACnB,QAAI,aAAa;AACjB,QAAI,qBAAqB;AAKzB,UAAM,WAAW,MAAM,mBAAmB,aAAa,GAAG,OAAO,MAAM;AACrE,UAAI;AAEF,cAAM,UAAU,WAAW,EAAE,MAAM,MAAM;AACzC,YAAIC,SAAQ;AACZ,YAAI,YAAY;AAEhB,YAAI,SAAS;AAEX,kBAAQ,IAAI,4BAA4B,EAAE,IAAI,MAAM,OAAO,qBAAqB,CAAC,CAAC,MAAM,EAAE;AAC1F,UAAAA,SAAQ,MAAM,kBAAkB,SAAS,MAAM;AAC/C,cAAIA,QAAO;AAGT,gBAAIA,OAAM,WAAW,QAAQA,OAAM,WAAW,QAAW;AACvD;AACA,sBAAQ,IAAI,yCAAoC,EAAE,IAAI,aAAaA,OAAM,MAAM,aAAaA,OAAM,kBAAkB,EAAE;AAAA,YACxH,OAAO;AAEL,sBAAQ,IAAI,iCAAuB,EAAE,IAAI,wCAAwC,OAAO,GAAG;AAC3F,0BAAY,EAAE,QAAQ,iBAAiB,UAAU,SAAS,OAAO,MAAM,YAAY,MAAM;AAAA,YAC3F;AACA,mBAAO;AAAA,cACL,GAAG;AAAA,cACH,QAAQ,OAAOA,OAAM,WAAW,WAAWA,OAAM,SAAS;AAAA,cAC1D,SAAS,OAAOA,OAAM,uBAAuB,WAAWA,OAAM,qBAAqB;AAAA,cACnF,QAAQ;AAAA,gBACN,UAAUA,OAAM,YAAY;AAAA,gBAC5B,MAAMA,OAAM,QAAQ;AAAA,cACtB;AAAA,cACA,QAAQ,aAAa,EAAE,QAAQ,iBAAiB,UAAU,SAAS,OAAO,MAAM,YAAY,KAAK;AAAA,YACnG;AAAA,UACF,OAAO;AAGL,kBAAM,oBAAoBA,WAAU,QAAQ;AAE5C,oBAAQ,MAAM,wCAAmC,EAAE,IAAI,gBAAgB,OAAO,GAAG;AACjF,oBAAQ,MAAM,wBAAwB,CAAC,CAAC,MAAM,EAAE;AAChD,oBAAQ,MAAM,uBAAuB,SAAS,OAAO,SAAS,CAAC,EAAE;AACjE,gBAAI,mBAAmB;AACrB,sBAAQ,MAAM,sEAA4D;AAC1E,mCAAqB;AAAA,YACvB;AAGA,gBAAI,oBAAoB;AACtB,sBAAQ,MAAM,+DAA+D;AAC7E,0BAAY;AAAA,gBACV,QAAQ;AAAA,gBACR,UAAU;AAAA,gBACV,OAAO;AAAA,gBACP,UAAU;AAAA,gBACV,gBAAgB,CAAC,CAAC;AAAA,gBAClB,eAAe,SAAS,OAAO,SAAS;AAAA,gBACxC,OAAO;AAAA,cACT;AACA,qBAAO;AAAA,gBACL,GAAG;AAAA,gBACH,QAAQ;AAAA,gBACR,SAAS;AAAA,gBACT,QAAQ;AAAA,gBACR,QAAQ;AAAA,cACV;AAAA,YACF;AAEA,oBAAQ,MAAM,kCAAkC;AAChD,wBAAY;AAAA,cACV,QAAQ;AAAA,cACR,UAAU;AAAA,cACV,OAAO;AAAA,cACP,UAAU;AAAA,cACV,gBAAgB,CAAC,CAAC;AAAA,cAClB,eAAe,SAAS,OAAO,SAAS;AAAA,cACxC,OAAO,oBAAoB,4CAA4C;AAAA,YACzE;AAAA,UACF;AAAA,QACF;AAIA,YAAI,sBAAsB,CAAC,SAAS;AAClC,kBAAQ,IAAI,6BAA6B,EAAE,IAAI,8BAA8B;AAC7E,iBAAO;AAAA,YACL,GAAG;AAAA,YACH,QAAQ;AAAA,YACR,SAAS;AAAA,YACT,QAAQ;AAAA,YACR,QAAQ,EAAE,QAAQ,eAAe,OAAO,OAAO,SAAS,mBAAmB;AAAA,UAC7E;AAAA,QACF;AAEA,cAAM,UAAU;AAAA,UACd,GAAG,EAAE,IAAI,IAAI,aAAa;AAAA,UAC1B,GAAG,EAAE,IAAI;AAAA,UACT,EAAE;AAAA;AAAA,QACJ;AAEA,YAAI,aAAa,CAAC;AAClB,mBAAW,SAAS,SAAS;AAC3B,cAAI;AACF,kBAAM,UAAU,MAAM,oBAAoB,OAAO,MAAM;AACvD,yBAAa,WAAW,OAAO,OAAO;AAEtC,gBAAI,QAAQ,SAAS,EAAG;AAAA,UAC1B,SAAS,GAAG;AAEV;AAAA,UACF;AAAA,QACF;AAGA,cAAM,mBAAmB,CAAC;AAC1B,cAAM,eAAe,oBAAI,IAAI;AAC7B,mBAAW,aAAa,YAAY;AAClC,gBAAM,MAAM,UAAU;AACtB,cAAI,OAAO,CAAC,aAAa,IAAI,GAAG,GAAG;AACjC,yBAAa,IAAI,GAAG;AACpB,6BAAiB,KAAK,SAAS;AAAA,UACjC,WAAW,CAAC,KAAK;AAEf,6BAAiB,KAAK,SAAS;AAAA,UACjC;AAAA,QACF;AAEA,QAAAA,SAAQ,cAAc,EAAE,MAAM,gBAAgB;AAE9C,YAAIA,QAAO;AACT;AAAA,QACF,OAAO;AACL;AAEA,cAAI,cAAc,GAAG;AACnB,oBAAQ,IAAI,uBAAuB,EAAE,IAAI,aAAa,WAAW,MAAM,aAAa;AAAA,UACtF;AAAA,QACF;AAEA,eAAO;AAAA,UACL,GAAG;AAAA,UACH,QAAQ,OAAOA,QAAO,WAAW,WAAWA,OAAM,SAAS;AAAA,UAC3D,SAAS,OAAOA,QAAO,uBAAuB,WAAWA,OAAM,qBAAqB;AAAA,UACpF,QAAQA,SACJ;AAAA,YACE,UAAUA,OAAM,YAAY;AAAA,YAC5B,MAAMA,OAAM,QAAQ;AAAA,UACtB,IACA;AAAA,UACJ,QAAQ,cAAc,UAAU,EAAE,QAAQ,iBAAiB,UAAU,SAAS,OAAO,MAAM,IAAI,EAAE,QAAQ,eAAe,OAAOA,WAAU,KAAK;AAAA,QAChJ;AAAA,MACF,SAAS,GAAG;AACV;AACA,cAAM,WAAW,EAAE,WAAW,OAAO,CAAC;AACtC,eAAO,KAAK,EAAE,YAAY,EAAE,MAAM,OAAO,SAAS,CAAC;AAGnD,YAAI,SAAS,SAAS,sBAAsB,GAAG;AAC7C,kBAAQ,MAAM,yDAA+C,EAAE,IAAI,6EAA6E;AAChJ,kBAAQ,MAAM,oEAAoE;AAAA,QACpF,OAAO;AAEL,cAAI,OAAO,UAAU,GAAG;AACtB,oBAAQ,MAAM,mCAAmC,EAAE,IAAI,MAAM,QAAQ;AAAA,UACvE;AAAA,QACF;AACA,eAAO,EAAE,GAAG,GAAG,QAAQ,MAAM,SAAS,MAAM,QAAQ,KAAK;AAAA,MAC3D;AAAA,IACF,CAAC;AAGD,YAAQ,IAAI,oCAAoC,YAAY,aAAa,UAAU,YAAY,OAAO,MAAM,SAAS;AACrH,QAAI,OAAO,SAAS,KAAK,OAAO,UAAU,GAAG;AAC3C,cAAQ,MAAM,kBAAkB,MAAM;AAAA,IACxC;AAGA,UAAM,cAAc,SAAS,OAAO,OAAK,EAAE,WAAW,IAAI,EAAE;AAC5D,UAAM,QAAQ,SAAS;AAGvB,UAAM,mBAAmB,SAAS,IAAI,CAAC,EAAE,QAAQ,GAAG,KAAK,MAAM,IAAI;AAEnE,UAAM,OAAO;AAAA,MACX,MAAM,EAAE,IAAI,QAAQ,MAAM,UAAU,MAAM,cAAc,UAAU,aAAa;AAAA,MAC/E,QAAQ;AAAA,MACR,oBAAoB;AAAA,MACpB,aAAa;AAAA,MACb,QAAQ;AAAA,QACN,mBAAmB;AAAA,QACnB,0BAA0B;AAAA,QAC1B,6BAA6B,QAAQ;AAAA;AAAA,QAErC,mCAAmC,SAChC,OAAO,OAAK,EAAE,WAAW,IAAI,EAC7B,IAAI,QAAM;AAAA,UACT,MAAM,EAAE;AAAA,UACR,cAAc,CAAC,CAAC,WAAW,EAAE,MAAM,MAAM;AAAA,UACzC,UAAU,WAAW,EAAE,MAAM,MAAM;AAAA,UACnC,OAAO,EAAE;AAAA,QACX,EAAE;AAAA,MACN;AAAA,IACF;AAEA,UAAM,UAAU,IAAI,QAAQ;AAC5B,YAAQ,IAAI,gBAAgB,kBAAkB;AAC9C,YAAQ,IAAI,iBAAiB,mBAAmB,iBAAiB,EAAE;AACnE,YAAQ,IAAI,QAAQ,iBAAiB;AAGrC,YAAQ,IAAI,+BAA+B,GAAG;AAC9C,YAAQ,IAAI,gCAAgC,oBAAoB;AAChE,YAAQ,IAAI,gCAAgC,6BAA6B;AACzE,YAAQ,IAAI,0BAA0B,OAAO;AAE7C,UAAM,WAAW,IAAI,SAAS,KAAK,UAAU,IAAI,GAAG,EAAE,QAAQ,KAAK,QAAQ,CAAC;AAC5E,YAAQ,UAAU,MAAM,IAAI,UAAU,SAAS,MAAM,CAAC,CAAC;AACvD,WAAO;AAAA,EACT,SAAS,OAAO;AACd,YAAQ,MAAM,kCAAkC,KAAK;AACrD,WAAO;AAAA,MACL;AAAA,QACE,OAAO;AAAA,QACP,SAAS,MAAM;AAAA,MACjB;AAAA,MACA;AAAA,IACF;AAAA,EACF;AACF;AArSsB,OAAAF,YAAA;;;ACxQtB,eAAsBG,WAAU,SAAS;AACvC,QAAM,EAAE,QAAQ,IAAI;AAGpB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAGA,MAAI,QAAQ,WAAW,OAAO;AAC5B,WAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAAA,EAC1D;AAEA,MAAI;AACF,UAAM,QAAQ,CAAC;AACf,UAAM,UAAU,kBAAkB;AAElC,eAAW,UAAU,SAAS;AAC5B,YAAM,OAAO,YAAY,MAAM;AAC/B,YAAM,KAAK;AAAA,QACT,IAAI;AAAA,QACJ,MAAM,KAAK;AAAA,QACX,cAAc,KAAK;AAAA,MACrB,CAAC;AAAA,IACH;AAEA,WAAO,aAAa,EAAE,MAAM,CAAC;AAAA,EAC/B,SAAS,OAAO;AACd,YAAQ,MAAM,yBAAyB,KAAK;AAC5C,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AAlCsB,OAAAA,YAAA;;;ACAtB,eAAsBC,WAAU,SAAS;AACvC,QAAM,EAAE,QAAQ,IAAI;AAGpB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAGA,MAAI,QAAQ,WAAW,OAAO;AAC5B,WAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAAA,EAC1D;AAEA,MAAI;AACF,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,SAAS,IAAI,aAAa,IAAI,SAAS,KAAK;AAClD,UAAM,cAAc,IAAI,aAAa,IAAI,cAAc,KAAK;AAC5D,QAAI;AAEJ,UAAM,kBAAkB,IAAI,aAAa,IAAI,YAAY;AACzD,QAAI,iBAAiB;AAEnB,YAAM,eAAe,gBAAgB,MAAM,GAAG,EAAE,IAAI,OAAK,EAAE,KAAK,CAAC;AACjE,oBAAc,2BAA2B,cAAc,QAAQ,WAAW;AAAA,IAC5E,OAAO;AAEL,YAAM,gBAAgB,iBAAiB,MAAM;AAC7C,oBAAc,2BAA2B,eAAe,QAAQ,WAAW;AAAA,IAC7E;AAEA,WAAO,aAAa;AAAA,MAClB;AAAA,MACA,OAAO,YAAY;AAAA,IACrB,CAAC;AAAA,EACH,SAAS,OAAO;AACd,YAAQ,MAAM,+BAA+B,KAAK;AAClD,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AAzCsB,OAAAA,YAAA;;;ACCtB,eAAsBC,WAAU,SAAS;AACvC,QAAM,EAAE,SAAS,IAAI,IAAI;AAGzB,MAAI,QAAQ,WAAW,WAAW;AAChC,WAAO,mBAAmB;AAAA,EAC5B;AAGA,MAAI,QAAQ,WAAW,QAAQ;AAC7B,WAAO,aAAa,EAAE,OAAO,qBAAqB,GAAG,GAAG;AAAA,EAC1D;AAEA,MAAI;AAEF,QAAI;AACJ,QAAI;AACF,aAAO,MAAM,QAAQ,KAAK;AAAA,IAC5B,SAAS,GAAG;AACV,aAAO,aAAa,EAAE,QAAQ,+BAA+B,GAAG,GAAG;AAAA,IACrE;AAEA,QAAI,CAAC,QAAQ,CAAC,KAAK,uBAAuB,KAAK,oBAAoB,WAAW,GAAG;AAC/E,aAAO,aAAa,EAAE,QAAQ,yCAAyC,GAAG,GAAG;AAAA,IAC/E;AAEA,UAAM,SAAS,KAAK,WAAW;AAC/B,UAAM,qBAAqB,KAAK;AAGhC,UAAM,uBAAuB,2BAA2B,oBAAoB,MAAM;AAElF,QAAI,qBAAqB,WAAW,GAAG;AACrC,aAAO,aAAa,EAAE,QAAQ,8CAA8C,GAAG,GAAG;AAAA,IACpF;AAGA,UAAM,qBAAqB,qBAAqB,KAAK,MAAM,KAAK,OAAO,IAAI,qBAAqB,MAAM,CAAC;AAGvG,QAAI;AACF,YAAM,KAAK,cAAc,GAAG;AAC5B,YAAM,SAAS,aAAa;AAC5B,YAAM,YAAY,oBAAoB;AAGtC,YAAMC,UAAS,MAAM,GAAG;AAAA,QACtB;AAAA;AAAA;AAAA;AAAA,MAIF,EAAE;AAAA,QACA;AAAA,QACA,mBAAmB;AAAA,QACnB,mBAAmB,QAAQ;AAAA,QAC3B,mBAAmB,SAAS;AAAA,QAC5B,mBAAmB;AAAA,QACnB,KAAK,gBAAgB;AAAA,QACrB;AAAA,QACA;AAAA,QACA,KAAK,UAAU,kBAAkB;AAAA,QACjC;AAAA,MACF,EAAE,IAAI;AAEN,UAAI,CAACA,QAAO,SAAS;AACnB,gBAAQ,MAAM,mBAAmBA,QAAO,KAAK;AAAA,MAE/C;AAEA,aAAO,aAAa;AAAA,QAClB,iBAAiB,mBAAmB;AAAA,QACpC,iBAAiB,mBAAmB;AAAA,QACpC,kBAAkB,mBAAmB;AAAA,QACrC,UAAU,mBAAmB;AAAA,QAC7B,WAAW,IAAI,KAAK,YAAY,GAAI,EAAE,YAAY;AAAA,QAClD,SAAS;AAAA,QACT,MAAM,mBAAmB;AAAA,QACzB,kBAAkB,kBAAkB,mBAAmB,MAAM,MAAM;AAAA,MACrE,CAAC;AAAA,IACH,SAAS,SAAS;AAChB,cAAQ,MAAM,mBAAmB,OAAO;AAExC,aAAO,aAAa;AAAA,QAClB,iBAAiB,mBAAmB;AAAA,QACpC,iBAAiB,mBAAmB;AAAA,QACpC,kBAAkB,mBAAmB;AAAA,QACrC,UAAU,mBAAmB;AAAA,QAC7B,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,QAClC,SAAS;AAAA,QACT,MAAM,mBAAmB;AAAA,QACzB,kBAAkB,kBAAkB,mBAAmB,MAAM,MAAM;AAAA,MACrE,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,2BAA2B,KAAK;AAC9C,WAAO,aAAa;AAAA,MAClB,OAAO;AAAA,MACP,SAAS,MAAM;AAAA,IACjB,GAAG,GAAG;AAAA,EACR;AACF;AApGsB,OAAAD,YAAA;;;ACGf,IAAM,SAAS;AAAA,EAClB;AAAA,IACE,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,YAA2B;AAAA,EACvC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,aAA4B;AAAA,EACxC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACE,UAA6B;AAAA,EACzC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,UAAyB;AAAA,EACrC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,UAA8B;AAAA,EAC1C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,UAAwB;AAAA,EACpC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,UAA8B;AAAA,EAC1C;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAACA,UAAuB;AAAA,EACnC;AAAA,EACF;AAAA,IACI,WAAW;AAAA,IACX,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,aAAa,CAAC;AAAA,IACd,SAAS,CAAC,SAAwB;AAAA,EACpC;AACF;;;ACtDF,SAAS,MAAM,KAAW;AACxB,MAAM,SAAqB,CAAA;AAC3B,MAAI,IAAI;AAER,SAAO,IAAI,IAAI,QAAQ;AACrB,QAAM,OAAO,IAAI,CAAC;AAElB,QAAI,SAAS,OAAO,SAAS,OAAO,SAAS,KAAK;AAChD,aAAO,KAAK,EAAE,MAAM,YAAY,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;AAC3D;;AAGF,QAAI,SAAS,MAAM;AACjB,aAAO,KAAK,EAAE,MAAM,gBAAgB,OAAO,KAAK,OAAO,IAAI,GAAG,EAAC,CAAE;AACjE;;AAGF,QAAI,SAAS,KAAK;AAChB,aAAO,KAAK,EAAE,MAAM,QAAQ,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;AACvD;;AAGF,QAAI,SAAS,KAAK;AAChB,aAAO,KAAK,EAAE,MAAM,SAAS,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;AACxD;;AAGF,QAAI,SAAS,KAAK;AAChB,UAAI,OAAO;AACX,UAAI,IAAI,IAAI;AAEZ,aAAO,IAAI,IAAI,QAAQ;AACrB,YAAM,OAAO,IAAI,WAAW,CAAC;AAE7B;;UAEG,QAAQ,MAAM,QAAQ;UAEtB,QAAQ,MAAM,QAAQ;UAEtB,QAAQ,MAAM,QAAQ;UAEvB,SAAS;UACT;AACA,kBAAQ,IAAI,GAAG;AACf;;AAGF;;AAGF,UAAI,CAAC;AAAM,cAAM,IAAI,UAAU,6BAAA,OAA6B,CAAC,CAAE;AAE/D,aAAO,KAAK,EAAE,MAAM,QAAQ,OAAO,GAAG,OAAO,KAAI,CAAE;AACnD,UAAI;AACJ;;AAGF,QAAI,SAAS,KAAK;AAChB,UAAI,QAAQ;AACZ,UAAI,UAAU;AACd,UAAI,IAAI,IAAI;AAEZ,UAAI,IAAI,CAAC,MAAM,KAAK;AAClB,cAAM,IAAI,UAAU,oCAAA,OAAoC,CAAC,CAAE;;AAG7D,aAAO,IAAI,IAAI,QAAQ;AACrB,YAAI,IAAI,CAAC,MAAM,MAAM;AACnB,qBAAW,IAAI,GAAG,IAAI,IAAI,GAAG;AAC7B;;AAGF,YAAI,IAAI,CAAC,MAAM,KAAK;AAClB;AACA,cAAI,UAAU,GAAG;AACf;AACA;;mBAEO,IAAI,CAAC,MAAM,KAAK;AACzB;AACA,cAAI,IAAI,IAAI,CAAC,MAAM,KAAK;AACtB,kBAAM,IAAI,UAAU,uCAAA,OAAuC,CAAC,CAAE;;;AAIlE,mBAAW,IAAI,GAAG;;AAGpB,UAAI;AAAO,cAAM,IAAI,UAAU,yBAAA,OAAyB,CAAC,CAAE;AAC3D,UAAI,CAAC;AAAS,cAAM,IAAI,UAAU,sBAAA,OAAsB,CAAC,CAAE;AAE3D,aAAO,KAAK,EAAE,MAAM,WAAW,OAAO,GAAG,OAAO,QAAO,CAAE;AACzD,UAAI;AACJ;;AAGF,WAAO,KAAK,EAAE,MAAM,QAAQ,OAAO,GAAG,OAAO,IAAI,GAAG,EAAC,CAAE;;AAGzD,SAAO,KAAK,EAAE,MAAM,OAAO,OAAO,GAAG,OAAO,GAAE,CAAE;AAEhD,SAAO;AACT;AAvGS;AAuHH,SAAU,MAAM,KAAa,SAA0B;AAA1B,MAAA,YAAA,QAAA;AAAA,cAAA,CAAA;EAA0B;AAC3D,MAAM,SAAS,MAAM,GAAG;AAChB,MAAA,KAAuC,QAAO,UAA9C,WAAQ,OAAA,SAAG,OAAI,IAAE,KAAsB,QAAO,WAA7B,YAAS,OAAA,SAAG,QAAK;AAC1C,MAAMC,UAAkB,CAAA;AACxB,MAAI,MAAM;AACV,MAAI,IAAI;AACR,MAAI,OAAO;AAEX,MAAM,aAAa,gCAAC,MAAsB;AACxC,QAAI,IAAI,OAAO,UAAU,OAAO,CAAC,EAAE,SAAS;AAAM,aAAO,OAAO,GAAG,EAAE;EACvE,GAFmB;AAInB,MAAM,cAAc,gCAAC,MAAsB;AACzC,QAAMC,SAAQ,WAAW,IAAI;AAC7B,QAAIA,WAAU;AAAW,aAAOA;AAC1B,QAAAC,MAA4B,OAAO,CAAC,GAA5B,WAAQA,IAAA,MAAE,QAAKA,IAAA;AAC7B,UAAM,IAAI,UAAU,cAAA,OAAc,UAAQ,MAAA,EAAA,OAAO,OAAK,aAAA,EAAA,OAAc,IAAI,CAAE;EAC5E,GALoB;AAOpB,MAAM,cAAc,kCAAA;AAClB,QAAIF,UAAS;AACb,QAAIC;AACJ,WAAQA,SAAQ,WAAW,MAAM,KAAK,WAAW,cAAc,GAAI;AACjE,MAAAD,WAAUC;;AAEZ,WAAOD;EACT,GAPoB;AASpB,MAAM,SAAS,gCAACC,QAAa;AAC3B,aAAmB,KAAA,GAAA,cAAA,WAAA,KAAA,YAAA,QAAA,MAAS;AAAvB,UAAME,QAAI,YAAA,EAAA;AAAe,UAAIF,OAAM,QAAQE,KAAI,IAAI;AAAI,eAAO;;AACnE,WAAO;EACT,GAHe;AAKf,MAAM,cAAc,gCAACC,SAAc;AACjC,QAAM,OAAOJ,QAAOA,QAAO,SAAS,CAAC;AACrC,QAAM,WAAWI,YAAW,QAAQ,OAAO,SAAS,WAAW,OAAO;AAEtE,QAAI,QAAQ,CAAC,UAAU;AACrB,YAAM,IAAI,UACR,8DAAA,OAA+D,KAAa,MAAI,GAAA,CAAG;;AAIvF,QAAI,CAAC,YAAY,OAAO,QAAQ;AAAG,aAAO,KAAA,OAAK,aAAa,SAAS,GAAC,KAAA;AACtE,WAAO,SAAA,OAAS,aAAa,QAAQ,GAAC,KAAA,EAAA,OAAM,aAAa,SAAS,GAAC,MAAA;EACrE,GAZoB;AAcpB,SAAO,IAAI,OAAO,QAAQ;AACxB,QAAM,OAAO,WAAW,MAAM;AAC9B,QAAM,OAAO,WAAW,MAAM;AAC9B,QAAM,UAAU,WAAW,SAAS;AAEpC,QAAI,QAAQ,SAAS;AACnB,UAAI,SAAS,QAAQ;AAErB,UAAI,SAAS,QAAQ,MAAM,MAAM,IAAI;AACnC,gBAAQ;AACR,iBAAS;;AAGX,UAAI,MAAM;AACR,QAAAJ,QAAO,KAAK,IAAI;AAChB,eAAO;;AAGT,MAAAA,QAAO,KAAK;QACV,MAAM,QAAQ;QACd;QACA,QAAQ;QACR,SAAS,WAAW,YAAY,MAAM;QACtC,UAAU,WAAW,UAAU,KAAK;OACrC;AACD;;AAGF,QAAM,QAAQ,QAAQ,WAAW,cAAc;AAC/C,QAAI,OAAO;AACT,cAAQ;AACR;;AAGF,QAAI,MAAM;AACR,MAAAA,QAAO,KAAK,IAAI;AAChB,aAAO;;AAGT,QAAM,OAAO,WAAW,MAAM;AAC9B,QAAI,MAAM;AACR,UAAM,SAAS,YAAW;AAC1B,UAAM,SAAO,WAAW,MAAM,KAAK;AACnC,UAAM,YAAU,WAAW,SAAS,KAAK;AACzC,UAAM,SAAS,YAAW;AAE1B,kBAAY,OAAO;AAEnB,MAAAA,QAAO,KAAK;QACV,MAAM,WAAS,YAAU,QAAQ;QACjC,SAAS,UAAQ,CAAC,YAAU,YAAY,MAAM,IAAI;QAClD;QACA;QACA,UAAU,WAAW,UAAU,KAAK;OACrC;AACD;;AAGF,gBAAY,KAAK;;AAGnB,SAAOA;AACT;AA7GgB;AA4PV,SAAU,MACd,KACA,SAAwE;AAExE,MAAM,OAAc,CAAA;AACpB,MAAM,KAAK,aAAa,KAAK,MAAM,OAAO;AAC1C,SAAO,iBAAoB,IAAI,MAAM,OAAO;AAC9C;AAPgB;AAYV,SAAU,iBACd,IACA,MACA,SAAqC;AAArC,MAAA,YAAA,QAAA;AAAA,cAAA,CAAA;EAAqC;AAE7B,MAAA,KAA8B,QAAO,QAArC,SAAM,OAAA,SAAG,SAAC,GAAS;AAAK,WAAA;EAAA,IAAC;AAEjC,SAAO,SAAU,UAAgB;AAC/B,QAAM,IAAI,GAAG,KAAK,QAAQ;AAC1B,QAAI,CAAC;AAAG,aAAO;AAEP,QAAG,OAAgB,EAAC,CAAA,GAAX,QAAU,EAAC;AAC5B,QAAM,SAAS,uBAAO,OAAO,IAAI;kDAExBK,IAAC;AACR,UAAI,EAAEA,EAAC,MAAM;;AAEb,UAAM,MAAM,KAAKA,KAAI,CAAC;AAEtB,UAAI,IAAI,aAAa,OAAO,IAAI,aAAa,KAAK;AAChD,eAAO,IAAI,IAAI,IAAI,EAAEA,EAAC,EAAE,MAAM,IAAI,SAAS,IAAI,MAAM,EAAE,IAAI,SAAC,OAAK;AAC/D,iBAAO,OAAO,OAAO,GAAG;QAC1B,CAAC;aACI;AACL,eAAO,IAAI,IAAI,IAAI,OAAO,EAAEA,EAAC,GAAG,GAAG;;;AAVvC,aAAS,IAAI,GAAG,IAAI,EAAE,QAAQ,KAAG;cAAxB,CAAC;;AAcV,WAAO,EAAE,MAAM,OAAO,OAAM;EAC9B;AACF;AA9BgB;AAmChB,SAAS,aAAa,KAAW;AAC/B,SAAO,IAAI,QAAQ,6BAA6B,MAAM;AACxD;AAFS;AAOT,SAAS,MAAM,SAAiC;AAC9C,SAAO,WAAW,QAAQ,YAAY,KAAK;AAC7C;AAFS;AAuBT,SAAS,eAAe,MAAc,MAAY;AAChD,MAAI,CAAC;AAAM,WAAO;AAElB,MAAM,cAAc;AAEpB,MAAI,QAAQ;AACZ,MAAI,aAAa,YAAY,KAAK,KAAK,MAAM;AAC7C,SAAO,YAAY;AACjB,SAAK,KAAK;;MAER,MAAM,WAAW,CAAC,KAAK;MACvB,QAAQ;MACR,QAAQ;MACR,UAAU;MACV,SAAS;KACV;AACD,iBAAa,YAAY,KAAK,KAAK,MAAM;;AAG3C,SAAO;AACT;AApBS;AAyBT,SAAS,cACP,OACA,MACA,SAA8C;AAE9C,MAAM,QAAQ,MAAM,IAAI,SAAC,MAAI;AAAK,WAAA,aAAa,MAAM,MAAM,OAAO,EAAE;EAAlC,CAAwC;AAC1E,SAAO,IAAI,OAAO,MAAA,OAAM,MAAM,KAAK,GAAG,GAAC,GAAA,GAAK,MAAM,OAAO,CAAC;AAC5D;AAPS;AAYT,SAAS,eACP,MACA,MACA,SAA8C;AAE9C,SAAO,eAAe,MAAM,MAAM,OAAO,GAAG,MAAM,OAAO;AAC3D;AANS;AA0CH,SAAU,eACd,QACA,MACA,SAAmC;AAAnC,MAAA,YAAA,QAAA;AAAA,cAAA,CAAA;EAAmC;AAGjC,MAAA,KAME,QAAO,QANT,SAAM,OAAA,SAAG,QAAK,IACd,KAKE,QAAO,OALT,QAAK,OAAA,SAAG,OAAI,IACZ,KAIE,QAAO,KAJT,MAAG,OAAA,SAAG,OAAI,IACV,KAGE,QAAO,QAHT,SAAM,OAAA,SAAG,SAAC,GAAS;AAAK,WAAA;EAAA,IAAC,IACzB,KAEE,QAAO,WAFT,YAAS,OAAA,SAAG,QAAK,IACjB,KACE,QAAO,UADT,WAAQ,OAAA,SAAG,KAAE;AAEf,MAAM,aAAa,IAAA,OAAI,aAAa,QAAQ,GAAC,KAAA;AAC7C,MAAM,cAAc,IAAA,OAAI,aAAa,SAAS,GAAC,GAAA;AAC/C,MAAI,QAAQ,QAAQ,MAAM;AAG1B,WAAoB,KAAA,GAAA,WAAA,QAAA,KAAA,SAAA,QAAA,MAAQ;AAAvB,QAAM,QAAK,SAAA,EAAA;AACd,QAAI,OAAO,UAAU,UAAU;AAC7B,eAAS,aAAa,OAAO,KAAK,CAAC;WAC9B;AACL,UAAM,SAAS,aAAa,OAAO,MAAM,MAAM,CAAC;AAChD,UAAM,SAAS,aAAa,OAAO,MAAM,MAAM,CAAC;AAEhD,UAAI,MAAM,SAAS;AACjB,YAAI;AAAM,eAAK,KAAK,KAAK;AAEzB,YAAI,UAAU,QAAQ;AACpB,cAAI,MAAM,aAAa,OAAO,MAAM,aAAa,KAAK;AACpD,gBAAM,MAAM,MAAM,aAAa,MAAM,MAAM;AAC3C,qBAAS,MAAA,OAAM,QAAM,MAAA,EAAA,OAAO,MAAM,SAAO,MAAA,EAAA,OAAO,MAAM,EAAA,OAAG,QAAM,KAAA,EAAA,OAAM,MAAM,SAAO,MAAA,EAAA,OAAO,QAAM,GAAA,EAAA,OAAI,GAAG;iBACjG;AACL,qBAAS,MAAA,OAAM,QAAM,GAAA,EAAA,OAAI,MAAM,SAAO,GAAA,EAAA,OAAI,QAAM,GAAA,EAAA,OAAI,MAAM,QAAQ;;eAE/D;AACL,cAAI,MAAM,aAAa,OAAO,MAAM,aAAa,KAAK;AACpD,kBAAM,IAAI,UACR,mBAAA,OAAmB,MAAM,MAAI,+BAAA,CAA+B;;AAIhE,mBAAS,IAAA,OAAI,MAAM,SAAO,GAAA,EAAA,OAAI,MAAM,QAAQ;;aAEzC;AACL,iBAAS,MAAA,OAAM,MAAM,EAAA,OAAG,QAAM,GAAA,EAAA,OAAI,MAAM,QAAQ;;;;AAKtD,MAAI,KAAK;AACP,QAAI,CAAC;AAAQ,eAAS,GAAA,OAAG,aAAW,GAAA;AAEpC,aAAS,CAAC,QAAQ,WAAW,MAAM,MAAA,OAAM,YAAU,GAAA;SAC9C;AACL,QAAM,WAAW,OAAO,OAAO,SAAS,CAAC;AACzC,QAAM,iBACJ,OAAO,aAAa,WAChB,YAAY,QAAQ,SAAS,SAAS,SAAS,CAAC,CAAC,IAAI,KACrD,aAAa;AAEnB,QAAI,CAAC,QAAQ;AACX,eAAS,MAAA,OAAM,aAAW,KAAA,EAAA,OAAM,YAAU,KAAA;;AAG5C,QAAI,CAAC,gBAAgB;AACnB,eAAS,MAAA,OAAM,aAAW,GAAA,EAAA,OAAI,YAAU,GAAA;;;AAI5C,SAAO,IAAI,OAAO,OAAO,MAAM,OAAO,CAAC;AACzC;AAvEgB;AAqFV,SAAU,aACd,MACA,MACA,SAA8C;AAE9C,MAAI,gBAAgB;AAAQ,WAAO,eAAe,MAAM,IAAI;AAC5D,MAAI,MAAM,QAAQ,IAAI;AAAG,WAAO,cAAc,MAAM,MAAM,OAAO;AACjE,SAAO,eAAe,MAAM,MAAM,OAAO;AAC3C;AARgB;;;ACrnBhB,IAAM,cAAc;AAwDpB,UAAU,eAAe,SAAkB;AAC1C,QAAM,cAAc,IAAI,IAAI,QAAQ,GAAG,EAAE;AAGzC,aAAW,SAAS,CAAC,GAAG,MAAM,EAAE,QAAQ,GAAG;AAC1C,QAAI,MAAM,UAAU,MAAM,WAAW,QAAQ,QAAQ;AACpD;AAAA,IACD;AAGA,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,cAAc,aAAa,WAAW;AAC5C,UAAM,mBAAmB,aAAa,WAAW;AACjD,QAAI,eAAe,kBAAkB;AACpC,iBAAW,WAAW,MAAM,YAAY,KAAK,GAAG;AAC/C,cAAM;AAAA,UACL;AAAA,UACA,QAAQ,YAAY;AAAA,UACpB,MAAM,iBAAiB;AAAA,QACxB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAGA,aAAW,SAAS,QAAQ;AAC3B,QAAI,MAAM,UAAU,MAAM,WAAW,QAAQ,QAAQ;AACpD;AAAA,IACD;AACA,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,eAAe,MAAM,MAAM,UAAU,QAAQ,aAAa,MAAM,GAAG;AAAA,MACxE,KAAK;AAAA,IACN,CAAC;AACD,UAAM,cAAc,aAAa,WAAW;AAC5C,UAAM,mBAAmB,aAAa,WAAW;AACjD,QAAI,eAAe,oBAAoB,MAAM,QAAQ,QAAQ;AAC5D,iBAAW,WAAW,MAAM,QAAQ,KAAK,GAAG;AAC3C,cAAM;AAAA,UACL;AAAA,UACA,QAAQ,YAAY;AAAA,UACpB,MAAM,YAAY;AAAA,QACnB;AAAA,MACD;AACA;AAAA,IACD;AAAA,EACD;AACD;AArDU;AAuDV,IAAO,gCAAQ;AAAA,EACd,MAAM,MACL,iBACA,KACA,eACC;AACD,QAAI,UAAU;AACd,UAAM,kBAAkB,eAAe,OAAO;AAC9C,QAAI,OAAO,CAAC;AACZ,QAAI,aAAa;AAEjB,UAAM,OAAO,8BAAO,OAAqB,SAAuB;AAC/D,UAAI,UAAU,QAAW;AACxB,YAAI,MAAM;AACV,YAAI,OAAO,UAAU,UAAU;AAC9B,gBAAM,IAAI,IAAI,OAAO,QAAQ,GAAG,EAAE,SAAS;AAAA,QAC5C;AACA,kBAAU,IAAI,QAAQ,KAAK,IAAI;AAAA,MAChC;AAEA,YAAMC,UAAS,gBAAgB,KAAK;AAEpC,UAAIA,QAAO,SAAS,OAAO;AAC1B,cAAM,EAAE,SAAS,QAAQ,KAAK,IAAIA,QAAO;AACzC,cAAM,UAAU;AAAA,UACf,SAAS,IAAI,QAAQ,QAAQ,MAAM,CAAC;AAAA,UACpC,cAAc;AAAA,UACd;AAAA,UACA;AAAA,UACA,IAAI,OAAO;AACV,mBAAO;AAAA,UACR;AAAA,UACA,IAAI,KAAK,OAAO;AACf,gBAAI,OAAO,UAAU,YAAY,UAAU,MAAM;AAChD,oBAAM,IAAI,MAAM,gCAAgC;AAAA,YACjD;AAEA,mBAAO;AAAA,UACR;AAAA,UACA;AAAA,UACA,WAAW,cAAc,UAAU,KAAK,aAAa;AAAA,UACrD,wBAAwB,6BAAM;AAC7B,yBAAa;AAAA,UACd,GAFwB;AAAA,QAGzB;AAEA,cAAM,WAAW,MAAM,QAAQ,OAAO;AAEtC,YAAI,EAAE,oBAAoB,WAAW;AACpC,gBAAM,IAAI,MAAM,8CAA8C;AAAA,QAC/D;AAEA,eAAO,cAAc,QAAQ;AAAA,MAC9B,WAAW,UAAsB;AAEhC,cAAM,WAAW,MAAM,IAAI,QAAoB,EAAE,MAAM,OAAO;AAC9D,eAAO,cAAc,QAAQ;AAAA,MAC9B,OAAO;AAEN,cAAM,WAAW,MAAM,MAAM,OAAO;AACpC,eAAO,cAAc,QAAQ;AAAA,MAC9B;AAAA,IACD,GAnDa;AAqDb,QAAI;AACH,aAAO,MAAM,KAAK;AAAA,IACnB,SAAS,OAAO;AACf,UAAI,YAAY;AACf,cAAM,WAAW,MAAM,IAAI,QAAoB,EAAE,MAAM,OAAO;AAC9D,eAAO,cAAc,QAAQ;AAAA,MAC9B;AAEA,YAAM;AAAA,IACP;AAAA,EACD;AACD;AAGA,IAAM,gBAAgB,wBAAC;AAAA;AAAA,EAEtB,IAAI;AAAA,IACH,CAAC,KAAK,KAAK,KAAK,GAAG,EAAE,SAAS,SAAS,MAAM,IAAI,OAAO,SAAS;AAAA,IACjE;AAAA,EACD;AAAA,GALqB;;;AC9LtB,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,UAAE;AACD,QAAI;AACH,UAAI,QAAQ,SAAS,QAAQ,CAAC,QAAQ,UAAU;AAC/C,cAAM,SAAS,QAAQ,KAAK,UAAU;AACtC,eAAO,EAAE,MAAM,OAAO,KAAK,GAAG,MAAM;AAAA,QAAC;AAAA,MACtC;AAAA,IACD,SAAS,GAAG;AACX,cAAQ,MAAM,4CAA4C,CAAC;AAAA,IAC5D;AAAA,EACD;AACD,GAb8B;AAe9B,IAAO,6CAAQ;;;ACRf,SAAS,YAAY,GAAmB;AACvC,SAAO;AAAA,IACN,MAAM,GAAG;AAAA,IACT,SAAS,GAAG,WAAW,OAAO,CAAC;AAAA,IAC/B,OAAO,GAAG;AAAA,IACV,OAAO,GAAG,UAAU,SAAY,SAAY,YAAY,EAAE,KAAK;AAAA,EAChE;AACD;AAPS;AAUT,IAAM,YAAwB,8BAAO,SAAS,KAAK,MAAM,kBAAkB;AAC1E,MAAI;AACH,WAAO,MAAM,cAAc,KAAK,SAAS,GAAG;AAAA,EAC7C,SAAS,GAAQ;AAChB,UAAM,QAAQ,YAAY,CAAC;AAC3B,WAAO,SAAS,KAAK,OAAO;AAAA,MAC3B,QAAQ;AAAA,MACR,SAAS,EAAE,+BAA+B,OAAO;AAAA,IAClD,CAAC;AAAA,EACF;AACD,GAV8B;AAY9B,IAAO,2CAAQ;;;ACzBJ,IAAM,mCAAmC;AAAA,EAE9B;AAAA,EAAyB;AAC3C;AACA,IAAO,sCAAQ;;;ACcnB,IAAM,wBAAsC,CAAC;AAKtC,SAAS,uBAAuB,MAAqC;AAC3E,wBAAsB,KAAK,GAAG,KAAK,KAAK,CAAC;AAC1C;AAFgB;AAShB,SAAS,uBACR,SACA,KACA,KACA,UACA,iBACsB;AACtB,QAAM,CAAC,MAAM,GAAG,IAAI,IAAI;AACxB,QAAM,gBAAmC;AAAA,IACxC;AAAA,IACA,KAAK,YAAY,QAAQ;AACxB,aAAO,uBAAuB,YAAY,QAAQ,KAAK,UAAU,IAAI;AAAA,IACtE;AAAA,EACD;AACA,SAAO,KAAK,SAAS,KAAK,KAAK,aAAa;AAC7C;AAfS;AAiBF,SAAS,kBACf,SACA,KACA,KACA,UACA,iBACsB;AACtB,SAAO,uBAAuB,SAAS,KAAK,KAAK,UAAU;AAAA,IAC1D,GAAG;AAAA,IACH;AAAA,EACD,CAAC;AACF;AAXgB;;;AC3ChB,IAAM,iCAAN,MAAM,gCAA8D;AAAA,EAGnE,YACU,eACA,MACT,SACC;AAHQ;AACA;AAGT,SAAK,WAAW;AAAA,EACjB;AAAA,EArBD,OAYoE;AAAA;AAAA;AAAA,EAC1D;AAAA,EAUT,UAAU;AACT,QAAI,EAAE,gBAAgB,kCAAiC;AACtD,YAAM,IAAI,UAAU,oBAAoB;AAAA,IACzC;AAEA,SAAK,SAAS;AAAA,EACf;AACD;AAEA,SAAS,oBAAoB,QAA0C;AAEtE,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAEA,QAAM,kBAA+C,gCACpD,SACA,KACA,KACC;AACD,QAAI,OAAO,UAAU,QAAW;AAC/B,YAAM,IAAI,MAAM,6CAA6C;AAAA,IAC9D;AACA,WAAO,OAAO,MAAM,SAAS,KAAK,GAAG;AAAA,EACtC,GATqD;AAWrD,SAAO;AAAA,IACN,GAAG;AAAA,IACH,MAAM,SAAS,KAAK,KAAK;AACxB,YAAM,aAAyB,gCAAU,MAAM,MAAM;AACpD,YAAI,SAAS,eAAe,OAAO,cAAc,QAAW;AAC3D,gBAAM,aAAa,IAAI;AAAA,YACtB,KAAK,IAAI;AAAA,YACT,KAAK,QAAQ;AAAA,YACb,MAAM;AAAA,YAAC;AAAA,UACR;AACA,iBAAO,OAAO,UAAU,YAAY,KAAK,GAAG;AAAA,QAC7C;AAAA,MACD,GAT+B;AAU/B,aAAO,kBAAkB,SAAS,KAAK,KAAK,YAAY,eAAe;AAAA,IACxE;AAAA,EACD;AACD;AAxCS;AA0CT,SAAS,qBACR,OAC8B;AAE9B,MACC,qCAAqC,UACrC,iCAAiC,WAAW,GAC3C;AACD,WAAO;AAAA,EACR;AAEA,aAAW,cAAc,kCAAkC;AAC1D,wBAAoB,UAAU;AAAA,EAC/B;AAGA,SAAO,cAAc,MAAM;AAAA,IAC1B,mBAAyE,wBACxE,SACA,KACA,QACI;AACJ,WAAK,MAAM;AACX,WAAK,MAAM;AACX,UAAI,MAAM,UAAU,QAAW;AAC9B,cAAM,IAAI,MAAM,sDAAsD;AAAA,MACvE;AACA,aAAO,MAAM,MAAM,OAAO;AAAA,IAC3B,GAXyE;AAAA,IAazE,cAA0B,wBAAC,MAAM,SAAS;AACzC,UAAI,SAAS,eAAe,MAAM,cAAc,QAAW;AAC1D,cAAM,aAAa,IAAI;AAAA,UACtB,KAAK,IAAI;AAAA,UACT,KAAK,QAAQ;AAAA,UACb,MAAM;AAAA,UAAC;AAAA,QACR;AACA,eAAO,MAAM,UAAU,UAAU;AAAA,MAClC;AAAA,IACD,GAT0B;AAAA,IAW1B,MAAM,SAAwD;AAC7D,aAAO;AAAA,QACN;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AACD;AAnDS;AAqDT,IAAI;AACJ,IAAI,OAAO,wCAAU,UAAU;AAC9B,kBAAgB,oBAAoB,mCAAK;AAC1C,WAAW,OAAO,wCAAU,YAAY;AACvC,kBAAgB,qBAAqB,mCAAK;AAC3C;AACA,IAAO,kCAAQ;",
  "names": ["result", "onRequest", "onRequest", "onRequest", "headers", "match", "onRequest", "onRequest", "onRequest", "result", "onRequest", "result", "value", "_a", "char", "prefix", "i", "result"]
}
